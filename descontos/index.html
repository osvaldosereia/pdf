<!DOCTYPE html>
<html lang="pt-BR" itemscope itemtype="https://schema.org/LocalBusiness">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta Econ√¥mica | Super Cestas Dona Ant√¥nia</title>
    <meta name="description" content="Cestas b√°sicas com qualidade e pre√ßo justo em Cuiab√° e V√°rzea Grande. Pe√ßa pelo WhatsApp!">
    <meta name="theme-color" content="#2563EB">
    
    <!-- OPEN GRAPH (Pilar 2: Otimiza√ß√£o de CTR Social) -->
    <meta property="og:title" content="Super Cestas Dona Ant√¥nia">
    <meta property="og:description" content="Garanta sua cesta b√°sica com o melhor pre√ßo da regi√£o.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:image" content="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif">

    <!-- PILLAR 3: SECURITY & ANTI-CLONE PROTOCOL -->
    <script>
        (function() {
            // Lista de dom√≠nios permitidos (White-label)
            const allowedDomains = ['www.donaantonia.com.br', 'donaantonia.com.br', 'localhost', '127.0.0.1'];
            const currentDomain = window.location.hostname;
            // Permite ambientes de preview do Google/Codesandbox para desenvolvimento
            const isPreviewEnv = currentDomain.includes('google') || currentDomain.includes('sandbox') || currentDomain.includes('content');
            
            const isAllowed = allowedDomains.some(d => currentDomain === d || currentDomain.endsWith('.' + d)) || isPreviewEnv;

            if (!isAllowed) {
                console.warn(`‚ö†Ô∏è [SECURITY] Acesso via dom√≠nio n√£o autorizado: ${currentDomain}. Redirecionamento preventivo recomendado em produ√ß√£o.`);
                // Em produ√ß√£o real, descomente a linha abaixo:
                // window.location.href = 'https://www.donaantonia.com.br';
            }
        })();
    </script>

    <!-- SCHEMA MARKUP (Pilar 1: Google Local SEO - JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "GroceryStore",
      "name": "Super Cestas Dona Ant√¥nia",
      "image": "https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif",
      "telephone": "+5565998150975",
      "priceRange": "$$",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Av. Principal do Coxip√≥",
        "addressLocality": "Cuiab√°",
        "addressRegion": "MT",
        "postalCode": "78000-000",
        "addressCountry": "BR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -15.6014, 
        "longitude": -56.0979
      },
      "openingHoursSpecification": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        "opens": "08:00",
        "closes": "18:00"
      },
      "sameAs": [
        "https://instagram.com/cestas.dona.antonia.cuiaba.vg",
        "https://facebook.com/cestas.dona.antonia"
      ]
    }
    </script>

    <!-- Performance: Preconnect & Icons -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* === MODERN MINIMALIST THEME === */
        :root {
            --primary: #2563EB;
            --primary-dark: #1d4ed8;
            --primary-light: #EFF6FF;
            --bg-color: #E2E8F0; 
            --text-main: #1E293B;
            --text-sub: #64748B;
            --white: #ffffff;
            --bubble-bot: #ffffff;
            --bubble-user: #2563EB;
            --text-user: #ffffff;
            --gold: #F59E0B;
            --shadow-sm: 0 1px 3px 0 rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --radius-bubble: 18px;
            --radius-card: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* PERFORMANCE & LAYOUT FIX */
        html {
            background-color: #cbd5e1;
            height: 100%;
        }

        body {
            height: 100%; 
            margin: 0 auto;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
            display: flex; flex-direction: column;
            max-width: 480px; 
            width: 100%;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .modern-header {
            background-color: var(--white);
            height: 70px;
            padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid #CBD5E1;
            z-index: 100; flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .brand-area { display: flex; align-items: center; gap: 12px; }
        .brand-logo { 
            width: 42px; height: 42px; 
            border-radius: 50%;
            object-fit: cover; box-shadow: var(--shadow-sm); 
        }
        .brand-info h1 { font-size: 16px; font-weight: 700; margin: 0; color: var(--text-main); }
        .status-badge { 
            display: inline-flex; align-items: center; gap: 6px; 
            font-size: 12px; color: #10B981; font-weight: 500; 
            background: #D1FAE5; padding: 4px 8px; border-radius: 20px; 
        }
        .status-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; }

        /* CHAT AREA */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 20px;
            padding-bottom: 90px; /* Space for floating buttons */
            background-color: var(--bg-color);
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* MESSAGES */
        .msg-row { 
            display: flex; width: 100%; margin-bottom: 16px; 
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
        }
        .msg-start { justify-content: flex-start; }
        .msg-end { justify-content: flex-end; }
        .msg-center { justify-content: center; margin-bottom: 12px; }

        .msg-bubble {
            padding: 14px 18px;
            max-width: 88%;
            font-size: 15px; line-height: 1.5;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .msg-bubble:has(.card-container), .msg-bubble:has(.basket-grid) {
            max-width: 98%;
            width: 100%;
            padding: 0;
            background: transparent;
            box-shadow: none;
        }

        .msg-in { 
            background-color: var(--bubble-bot); 
            color: var(--text-main);
            border-radius: var(--radius-bubble);
            border-bottom-left-radius: 4px;
        }
        
        .msg-out { 
            background-color: var(--bubble-user); 
            color: var(--text-user);
            border-radius: var(--radius-bubble);
            border-bottom-right-radius: 4px;
        }

        .msg-time { 
            display: block; text-align: right; 
            font-size: 10px; margin-top: 4px; opacity: 0.7; 
        }

        /* ANIMATIONS */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-dot { 
            width: 6px; height: 6px; background: #94A3B8; 
            border-radius: 50%; display: inline-block; 
            animation: typing 1.4s infinite; margin: 0 2px; 
        }
        @keyframes typing { 0%,100%{transform:scale(0.8);opacity:0.5} 50%{transform:scale(1.2);opacity:1} }

        /* INPUT AREA (HIDDEN PER REQUEST) */
        #input-footer {
            background-color: var(--white);
            padding: 16px 20px;
            border-top: 1px solid #CBD5E1;
            display: none; /* ESCONDIDO */
            align-items: center; gap: 12px;
            flex-shrink: 0; padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .modern-input {
            flex: 1; background: #F1F5F9; border-radius: 30px;
            padding: 14px 20px; border: 1px solid #CBD5E1;
            font-size: 16px; color: var(--text-main); outline: none;
            transition: all 0.2s;
        }
        .modern-input:focus { background: var(--white); border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }

        .send-btn-modern {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: transform 0.2s;
            box-shadow: 0 4px 10px rgba(37,99,235,0.3);
        }
        .send-btn-modern:active { transform: scale(0.92); }

        /* OPTIONS BUTTONS */
        .msg-options { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 5px; }
        
        .modern-btn {
            background: var(--white); border: 1px solid #CBD5E1;
            color: var(--primary); font-weight: 600; font-size: 15px;
            padding: 16px; border-radius: 16px; cursor: pointer;
            text-align: left; width: 100%; transition: all 0.2s;
            display: flex; flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .modern-btn:active { background: #F8FAFC; transform: scale(0.98); }
        .btn-sub { font-size: 12px; color: var(--text-sub); font-weight: 400; margin-top: 4px; }

        /* === PAYMENT METHODS CARD (NEW) === */
        .payment-card {
            background: white; border-radius: 16px; padding: 16px;
            border: 1px solid #E2E8F0; box-shadow: var(--shadow-sm);
        }
        .pay-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 0; border-bottom: 1px solid #F1F5F9;
        }
        .pay-item:last-child { border-bottom: none; }
        .pay-icon {
            width: 36px; height: 36px; border-radius: 50%;
            background: #EFF6FF; color: var(--primary);
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; flex-shrink: 0;
        }

        /* === MODERN CARDS === */
        .card-container { 
            width: 100%; 
            max-width: 100%;
            margin-bottom: 10px; 
        }
        
        .modern-card {
            background: var(--white);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid #CBD5E1;
            transition: all 0.3s ease;
        }

        /* VIP MODE STYLES */
        .modern-card.vip-active {
            border: 2px solid var(--gold);
            box-shadow: 0 10px 25px -5px rgba(245, 158, 11, 0.3), 0 8px 10px -6px rgba(245, 158, 11, 0.1);
        }

        .card-header-img {
            position: relative;
            height: 280px; 
            background: #F8FAFC;
            display: flex; 
            justify-content: flex-start;
            align-items: center;
            padding: 20px;
            padding-right: 90px;
        }
        
        .card-img-main {
            width: auto; height: auto;
            max-width: 100%; max-height: 240px; 
            object-fit: contain; 
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.1));
            transition: transform 0.3s ease;
            pointer-events: none; 
            -webkit-user-select: none;
            display: block;
            margin-right: auto;
        }
        
        .selo-modern {
            position: absolute; top: 16px; left: 16px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(4px);
            padding: 6px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; color: #B45309;
            box-shadow: var(--shadow-sm); border: 1px solid #FEF3C7;
            z-index: 2; 
        }

        .selo-vip {
            position: absolute; top: 16px; left: 16px;
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white; border: none;
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.4);
            animation: pulse-soft 2s infinite;
        }
        @keyframes pulse-soft {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        /* CHIPS NAVIGATION */
        .chips-float {
            position: absolute; right: 16px; top: 50%; 
            transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 8px;
            max-height: 90%; overflow-y: auto; padding: 4px;
            z-index: 5; min-width: 80px;
        }
        .chip-modern {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            padding: 8px 12px; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(4px); border-radius: 12px;
            border: 1px solid #E2E8F0; color: var(--text-sub);
            cursor: pointer; text-align: center;
            transition: all 0.2s; box-shadow: var(--shadow-sm);
        }
        .chip-modern.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(37,99,235,0.25);
        }
        .chip-modern.vip-active-chip {
            background: var(--gold); border-color: var(--gold); color: white;
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
        }

        /* PRODUCT SLIDER */
        .slider-section {
            padding: 16px 0; background: #fff;
            border-bottom: 1px solid #F1F5F9;
            position: relative;
        }
        .modern-slider {
            display: flex; gap: 12px; overflow-x: auto; padding: 0 20px;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
        }
        .modern-slider::-webkit-scrollbar { display: none; }
        
        .slide-item {
            flex: 0 0 130px;
            background: #F8FAFC; border-radius: 16px;
            padding: 8px 4px;
            text-align: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid transparent;
        }
        .slide-item img { 
            width: 105px; height: 105px;
            object-fit: contain; margin-bottom: 6px; 
            mix-blend-mode: multiply;
        }
        .slide-qty { font-size: 14px; font-weight: 700; color: var(--primary); }
        .slide-name { font-size: 11px; color: var(--text-sub); line-height: 1.3; }

        .nav-arrow {
            position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
            width: 36px; height: 36px; 
            background: #F59E0B; color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
            cursor: pointer; z-index: 10;
        }

        /* PRICE SECTION */
        .price-section { padding: 20px; background: white; }
        .price-row { 
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; font-size: 14px; color: var(--text-sub);
        }
        .price-val { font-weight: 700; color: var(--text-main); font-size: 16px; }

        .price-old {
            text-decoration: line-through;
            color: #ef4444; /* Vermelho */
            font-size: 13px;
            margin-right: 8px;
            font-weight: 400;
        }
        .price-new {
            color: #059669; /* Verde */
            font-weight: 800;
            font-size: 18px;
        }

        /* DISCOUNT WIDGET */
        .modern-discount {
            background: white; border-radius: var(--radius-card); border: 1px solid #E2E8F0;
            padding: 24px; text-align: center; box-shadow: var(--shadow-sm);
        }
        .discount-highlight {
            background: #ECFDF5; border: 1px dashed #10B981; border-radius: 16px;
            padding: 16px; margin-bottom: 16px;
        }
        .discount-big { font-size: 36px; font-weight: 800; color: #059669; display: block; margin: 4px 0; }
        .discount-label { font-size: 12px; color: #059669; font-weight: 600; text-transform: uppercase; }
        
        .btn-claim {
            width: 100%; padding: 16px; border-radius: 16px;
            background: var(--primary); color: white; font-weight: 700; border: none;
            font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 12px rgba(37,99,235,0.3); transition: transform 0.2s;
            text-decoration: none;
        }
        .btn-claim:active { transform: scale(0.97); }

        /* SOCIAL BUTTONS */
        .social-buttons-container {
            display: flex; flex-direction: column; gap: 12px;
            padding: 10px 20px;
            width: 100%;
        }
        .social-btn-lg {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; padding: 16px;
            border-radius: 50px;
            font-size: 16px; font-weight: 700;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .social-btn-lg:active { transform: scale(0.96); }
        
        .btn-insta { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; }
        .btn-vip { background: #25D366; color: white; }

        /* === FLOATING DOCK & MODAL === */
        .floating-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 999;
            width: max-content;
            padding: 0 20px;
        }

        .float-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            border: none;
            cursor: pointer;
        }
        .float-btn:active { transform: scale(0.95); }

        .float-whatsapp {
            background-color: #25D366;
            color: white;
        }

        .float-info {
            background-color: white;
            color: var(--text-main);
            border: 1px solid #E2E8F0;
        }

        /* Modal Info */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 340px;
            border-radius: 24px;
            padding: 24px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            animation: modalPop 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            border-bottom: 1px solid #F1F5F9;
            padding-bottom: 16px;
        }

        .modal-logo {
            width: 50px; height: 50px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: var(--shadow-sm);
        }

        .modal-title h3 { margin: 0; font-size: 15px; font-weight: 700; color: var(--text-main); line-height: 1.2; }
        .modal-cnpj { font-size: 11px; color: var(--text-sub); display: block; margin-top: 2px; }

        .modal-body ul {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }

        .modal-body li {
            font-size: 13px;
            color: var(--text-main);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body li i { color: var(--primary); font-size: 18px; }

        .modal-address {
            font-size: 12px;
            color: var(--text-sub);
            background: #F8FAFC;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 16px;
            line-height: 1.4;
            border: 1px solid #F1F5F9;
        }

        .modal-contact {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-main);
        }

        .close-modal {
            position: absolute;
            top: 16px; right: 16px;
            background: #F1F5F9;
            border: none;
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            color: var(--text-sub);
            transition: background 0.2s;
        }
        .close-modal:active { background: #E2E8F0; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="modern-header">
        <div class="brand-area">
            <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" 
                 class="brand-logo" 
                 alt="Logo Dona Antonia"
                 onerror="this.src='https://api.dicebear.com/7.x/initials/svg?seed=DA&backgroundColor=2563EB&textColor=ffffff'">
            <div class="brand-info">
                <h1>Cesta B√°sica Dona Ant√¥nia</h1>
                <div class="status-badge">
                    <div class="status-dot"></div> <span id="status-text">Online</span>
                </div>
            </div>
        </div>
        <div style="display:flex; gap:16px; color:var(--text-sub); font-size:22px;">
            <i class="ph ph-dots-three-vertical"></i>
        </div>
    </header>

    <!-- CHAT -->
    <main id="chat-container">
        <!-- Messages will appear here -->
    </main>

    <!-- FOOTER -->
    <footer id="input-footer">
        <input type="text" id="user-input" class="modern-input" placeholder="Escreva uma mensagem..." autocomplete="off">
        <button id="send-btn" class="send-btn-modern" aria-label="Enviar">
            <i class="ph-fill ph-paper-plane-right"></i>
        </button>
    </footer>

    <!-- FLOATING DOCK -->
    <div class="floating-dock">
        <a href="javascript:void(0)" onclick="openWaGeneric()" class="float-btn float-whatsapp">
            <i class="ph-bold ph-whatsapp-logo" style="font-size:20px"></i> Whatsapp
        </a>
        <button onclick="toggleModal(true)" class="float-btn float-info">
            <i class="ph-bold ph-info" style="font-size:20px; color:var(--primary)"></i> Conhe√ßa
        </button>
    </div>

    <!-- INFO MODAL -->
    <div id="infoModal" class="modal-overlay" onclick="if(event.target === this) toggleModal(false)">
        <div class="modal-content">
            <button class="close-modal" onclick="toggleModal(false)"><i class="ph-bold ph-x"></i></button>
            
            <div class="modal-header">
                <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" class="modal-logo" onerror="this.src='https://api.dicebear.com/7.x/initials/svg?seed=DA&backgroundColor=2563EB&textColor=ffffff'">
                <div class="modal-title">
                    <h3>Cestas B√°sicas Dona Antonia</h3>
                    <span class="modal-cnpj">CNPJ: 51.385.335.0001.06</span>
                </div>
            </div>

            <div class="modal-body">
                <ul>
                    <li><i class="ph-fill ph-check-circle"></i> 8 anos em Cuiab√° e VG</li>
                    <li><i class="ph-fill ph-package"></i> Mais de 30 mil cestas entregues</li>
                    <li>
                        <i class="ph-fill ph-facebook-logo" style="color:#1877F2"></i> 
                        <a href="https://facebook.com/cestas.dona.antonia" target="_blank" style="color:inherit; text-decoration:underline">Mais de 6 mil seguidores</a>
                    </li>
                    <li>
                        <i class="ph-fill ph-instagram-logo" style="color:#E1306C"></i>
                        <a href="https://www.instagram.com/cestas.dona.antonia.cuiaba.vg/" target="_blank" style="color:inherit; text-decoration:underline">Quase 2 mil seguidores</a>
                    </li>
                </ul>

                <div class="modal-address">
                    <a href="https://maps.google.com/?q=R.+Trinta,+105+-+Jardim+Nossa+Sra.+Aparecida,+Cuiab√°+-+MT,+78090-660" target="_blank" style="color:inherit; text-decoration:none; display:flex; gap:10px; align-items:start">
                        <i class="ph-fill ph-map-pin" style="color:#ef4444; flex-shrink:0; margin-top:2px; font-size:16px;"></i>
                        <span>R. Trinta, 105 - Jardim Nossa Sra. Aparecida, Cuiab√° - MT, 78090-660</span>
                    </a>
                </div>

                <div class="modal-contact">
                    <p style="margin:0 0 6px 0">üìû 65 99815-0975 | 65 99681-3588</p>
                    <a href="https://www.donaantonia.com.br" target="_blank" style="color:var(--primary); font-weight:700">www.donaantonia.com.br</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === L√ìGICA DE NEG√ìCIO & TRACKING ===
        
        window.dataLayer = window.dataLayer || [];
        function trackEvent(eventName, params = {}) {
            window.dataLayer.push({ 'event': eventName, ...params });
            console.log(`%c[MARKETING PIXEL] Event: ${eventName}`, "background: #22c55e; color: #fff; padding: 2px 5px; border-radius: 3px;", params);
        }

        // Toggle function para o Modal
        window.toggleModal = function(show) {
            const modal = document.getElementById('infoModal');
            modal.style.display = show ? 'flex' : 'none';
            if(show) trackEvent('ViewContent', { content_name: 'Modal Institucional' });
        }

        const CONFIG = {
            ownerName: "Osvaldo",
            whatsAppGroupLink: "https://chat.whatsapp.com/IOI3gSBLRVk4jGK2QMunp1",
            whatsAppNumber: "5565998150975", 
            whatsAppSaveNumber: "5565998150975",
            instagramLink: "https://www.instagram.com/cestas.dona.antonia.cuiaba.vg/"
        };

        const CESTAS = [
            {
                id: 'economica', nome: 'Cesta Econ√¥mica', destaque: 'Mais Vendida', desconto: 5, arrozQtd: 1, brindeNome: '1 Trigo 1kg',
                brindeImg: 'img/alimento/trigo vitoriosa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-economica.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '1 √ìleo de Soja Liza 900ml', '1 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Farinha de Mandioca Dona De 1Kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '1 Suco Frisco'],
                opcoes: [{ arroz: 'Valor √önico', preco: '85,00', valor_num: 85.00 }]
            },
            {
                id: 'mini', nome: 'Cesta Mini', desconto: 10, arrozQtd: 1, brindeNome: '1 Feij√£o 1kg',
                brindeImg: 'img/alimento/feij√£o da casa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-mini.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '1 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '165,00', valor_num: 165.00 }, { arroz: 'Koblenz', preco: '170,00', valor_num: 170.00 }]
            },
            {
                id: 'pequena', nome: 'Cesta Pequena', desconto: 15, arrozQtd: 2, brindeNome: '1 Amaciante 2L',
                brindeImg: 'img/limpeza/amaciante ype 2L.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-pequena.avif',
                items: ['2 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '215,00', valor_num: 215.00 }, { arroz: 'Koblenz', preco: '220,00', valor_num: 220.00 }]
            },
            {
                id: 'media', nome: 'Cesta M√©dia', desconto: 20, arrozQtd: 3, brindeNome: '1 Caf√© 250g',
                brindeImg: 'img/alimento/cafe caboclo 250g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-media.avif',
                items: ['3 Arroz Koblenz 5kg', '2 A√ß√∫car Doce Dia 2kg', '3 √ìleo de Soja Liza 900ml', '3 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '2 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '3 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '3 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '320,00', valor_num: 320.00 }, { arroz: 'Koblenz', preco: '325,00', valor_num: 325.00 }]
            },
            {
                id: 'grande', nome: 'Cesta Grande', desconto: 25, arrozQtd: 4, brindeNome: '1 OMO 800g',
                brindeImg: 'img/limpeza/sab√£o em p√≥ omo 800g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-grande.avif',
                items: ['4 Arroz Koblenz 5kg', '3 A√ß√∫car Doce Dia 2kg', '4 √ìleo de Soja Liza 900ml', '4 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '3 Espaguete QDelicia 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '4 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '4 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '380,00', valor_num: 380.00 }, { arroz: 'Koblenz', preco: '390,00', valor_num: 390.00 }]
            }
        ];

        // --- SISTEMA DE IMAGENS INTELIGENTE ---
        function getProductImage(text) {
            const t = text.toLowerCase();
            const folderAlimento = 'img/alimento/';
            const folderLimpeza = 'img/limpeza/';
            const placeholder = `https://placehold.co/100x100/f1f5f9/334155?text=${text.split(' ')[0]}`;

            if(t.includes('arroz')) return folderAlimento + 'Arroz Koblenz 5kg.webp';
            if(t.includes('a√ß√∫car') || t.includes('acucar')) return folderAlimento + 'a√ßucar doce dia 2 kg.webp';
            if(t.includes('bolacha')) return folderAlimento + 'bolacha mybit.webp';
            if(t.includes('bolo')) return folderAlimento + 'bolo apti chocolate.webp';
            if(t.includes('caf√©') || t.includes('cafe')) return t.includes('500g') ? folderAlimento + 'cafe caboclo 500g.webp' : folderAlimento + 'cafe caboclo 250g.webp';
            if(t.includes('espaguete') || t.includes('macarr√£o')) return folderAlimento + 'espaguete qdelicia.webp';
            if(t.includes('farinha')) return folderAlimento + 'farinha de mandioca.webp';
            if(t.includes('feij√£o') || t.includes('feijao')) return folderAlimento + 'feij√£o da casa.webp';
            if(t.includes('milho')) return folderAlimento + 'milho verde predileta.webp';
            if(t.includes('miojo')) return folderAlimento + 'miojo apti.webp';
            if(t.includes('molho')) return folderAlimento + 'molho fugini.webp';
            if(t.includes('oleo') || t.includes('√≥leo')) return folderAlimento + 'oleo de soja liza.webp';
            if(t.includes('ovo')) return folderAlimento + 'ovo duzia.jpg';
            if(t.includes('sal')) return folderAlimento + 'sal.webp';
            if(t.includes('suco')) return folderAlimento + 'suco frisco.webp';
            if(t.includes('tempero')) return folderAlimento + 'tempero tio jonas.jpg';
            if(t.includes('trigo')) return folderAlimento + 'trigo vitoriosa.webp';

            if(t.includes('creme dental')) return folderLimpeza + 'Creme Dental Sorriso 70g.webp';
            if(t.includes('desinfetante')) return folderLimpeza + 'Desinfetante Remmus 2L.webp';
            if(t.includes('detergente')) return folderLimpeza + 'Detergente Ype 500ml.webp';
            if(t.includes('qboa') || t.includes('sanit√°ria')) return folderLimpeza + 'Qboa 1 Litro.webp';
            if(t.includes('amaciante')) return folderLimpeza + 'amaciante ype 2L.webp';
            if(t.includes('papel hig')) return folderLimpeza + 'papel higienico.webp';
            if(t.includes('sabonete')) return folderLimpeza + 'sabonete palmolive 85g.webp';
            if(t.includes('sab√£o')) return t.includes('barra') ? folderLimpeza + 'sab√£o barra ype 900g.webp' : folderLimpeza + 'sab√£o em p√≥ omo 800g.webp';
            if(t.includes('esponja')) return folderLimpeza + 'esponja de lavar lou√ßa.webp';
            if(t.includes('l√£') || t.includes('aco')) return folderLimpeza + 'l√£ de a√ßo assolan.webp';

            return placeholder;
        }

        // --- SISTEMA DE CHAT ---
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusText = document.getElementById('status-text');
        const inputFooter = document.getElementById('input-footer');

        // Adicionei 'vipMode' e 'currentBasketIdx' no estado
        let state = { step: 0, userName: '', currentBasketIdx: 0, vipMode: false, timerRef: null };
        let appInitialized = false;

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addMessage(text, type = 'bot', delayOverride = null) {
            return new Promise(resolve => {
                let delay = 1200; 
                if (type === 'bot') {
                    const isCard = text.includes('modern-card') || text.includes('modern-discount') || text.includes('basket-grid') || text.includes('payment-card');
                    if (isCard) { delay = 1500; } 
                    else { delay = Math.min(text.length * 40 + 600, 3500); }
                } else { delay = 0; }

                if (delayOverride !== null) delay = delayOverride;
                
                setTimeout(() => {
                    if (type === 'bot') {
                        statusText.innerText = 'Digitando...';
                        const id = 'typing-' + Date.now();
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div id="${id}" class="msg-row msg-start">
                                <div class="msg-bubble msg-in">
                                    <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();

                        const typingTime = (text.includes('modern-card')) ? 1500 : delay; 
                        
                        setTimeout(() => {
                            const el = document.getElementById(id);
                            if(el) el.remove();
                            
                            const isComplex = text.includes('card-container') || text.includes('modern-discount') || text.includes('basket-grid');
                            const bubbleStyle = isComplex ? 'padding:0; background:transparent; box-shadow:none; max-width:100%; width:100%;' : '';

                            chatContainer.insertAdjacentHTML('beforeend', `
                                <div class="msg-row msg-start" style="${isComplex ? 'width:100%' : ''}">
                                    <div class="msg-bubble msg-in" style="${bubbleStyle}">
                                        ${text}
                                        ${!isComplex ? `<span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>` : ''}
                                    </div>
                                </div>
                            `);
                            statusText.innerText = 'Online';
                            scrollToBottom();
                            resolve();
                        }, typingTime);
                    } 
                    else if (type === 'system') {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-center">
                                ${text}
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                    else {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-end">
                                <div class="msg-bubble msg-out">
                                    ${text}
                                </div>
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                }, type === 'user' ? 0 : 500);
            });
        }

        function showOptions(opts) {
            setTimeout(() => {
                const id = 'opts-' + Date.now();
                const btns = opts.map(o => `
                    <button class="modern-btn" onclick="handleOpt('${o.val}', ${o.next}, '${id}', '${o.text}')">
                        ${o.text}
                        ${o.sub ? `<span class="btn-sub">${o.sub}</span>` : ''}
                    </button>
                `).join('');
                
                chatContainer.insertAdjacentHTML('beforeend', `
                    <div id="${id}" class="msg-options">${btns}</div>
                `);
                scrollToBottom();
            }, 800);
        }

        window.handleOpt = async function(val, next, id, text) {
            const el = document.getElementById(id);
            if(el) el.remove();
            
            if(state.timerRef) clearTimeout(state.timerRef);
            
            await addMessage(text, 'user');
            state.step = next;
            nextStep();
        };

        window.selectBasketChip = function(idx, containerId) {
            state.currentBasketIdx = idx; // Rastreia o √≠ndice atual para o link do whats
            
            // Se n√£o passar containerId (compatibilidade), tenta achar um padr√£o, mas ideal √© passar
            const targetId = containerId || 'unified-card-content';
            const container = document.getElementById(targetId);
            if(!container) return;
            
            container.style.opacity = '0.5';
            setTimeout(() => {
                // Passa o mesmo containerId para manter a refer√™ncia nos pr√≥ximos cliques
                container.innerHTML = getCardContent(CESTAS[idx], targetId);
                container.style.opacity = '1';
            }, 150);
        };

        window.scrollSlider = function(btn) {
            const wrapper = btn.parentElement;
            const slider = wrapper.querySelector('.modern-slider');
            if(slider) {
                slider.scrollBy({ left: 220, behavior: 'smooth' });
            }
        };

        function getCardContent(cesta, containerId) {
            // Verifica se est√° no modo VIP para alterar renderiza√ß√£o
            const isVip = state.vipMode;
            // Usa o containerId passado ou um default para evitar erro
            const cId = containerId || 'unified-card-content';
            
            const chips = CESTAS.map((c, i) => `
                <div class="chip-modern ${c.id === cesta.id ? (isVip ? 'vip-active-chip' : 'active') : ''}" 
                     onclick="selectBasketChip(${i}, '${cId}')">
                    ${c.nome.replace('Cesta ', '')}
                </div>
            `).join('');

            const slides = cesta.items.map(item => {
                const match = item.match(/^(\d+)\s+(.*)$/);
                let qty = "1 un", nome = item;
                if(match) { qty = match[1] + (parseInt(match[1]) > 1 ? ' un' : ' un'); nome = match[2]; }
                const imgPath = getProductImage(nome);
                return `
                <div class="slide-item">
                    <img src="${imgPath}" loading="lazy" alt="${nome}" onerror="this.src='https://placehold.co/60x60/f1f5f9/94a3b8?text=IMG'">
                    <span class="slide-qty">${qty}</span>
                    <span class="slide-name">${nome}</span>
                </div>`;
            }).join('');

            // Renderiza√ß√£o condicional de pre√ßo (Standard vs VIP)
            const precos = cesta.opcoes.map(o => {
                if (isVip) {
                    // C√ÅLCULO DE PRE√áO VIP
                    const oldPrice = o.valor_num;
                    const newPrice = oldPrice - cesta.desconto;
                    return `
                    <div class="price-row">
                        <span>${o.arroz.includes('Valor') ? 'Valor √önico' : 'Com ' + o.arroz}</span>
                        <div>
                            <span class="price-old">R$ ${o.preco}</span>
                            <span class="price-new">R$ ${newPrice.toFixed(2).replace('.', ',')}</span>
                        </div>
                    </div>`;
                } else {
                    return `
                    <div class="price-row">
                        <span>${o.arroz.includes('Valor') ? 'Valor √önico' : 'Com ' + o.arroz}</span>
                        <span class="price-val">R$ ${o.preco}</span>
                    </div>`;
                }
            }).join('');

            const absoluteUrl = cesta.img;
            const localFallback = 'img/' + absoluteUrl.split('/').pop();
            
            // Destaque VIP no cabe√ßalho
            const seloHtml = isVip 
                ? `<div class="selo-vip"><i class="ph-fill ph-ticket"></i> OFERTA ATIVA -R$ ${cesta.desconto}</div>`
                : (cesta.destaque ? `<div class="selo-modern"><i class="ph-fill ph-star"></i> ${cesta.destaque}</div>` : '');

            return `
                <div class="card-header-img">
                    ${seloHtml}
                    <img src="${absoluteUrl}" 
                         class="card-img-main" 
                         alt="${cesta.nome}" 
                         onerror="this.onerror=null;this.src='${localFallback}';">
                    <div class="chips-float">${chips}</div>
                </div>
                
                <div class="price-section" style="border-bottom: 1px solid #F1F5F9; padding-bottom: 10px;">
                    ${precos}
                </div>

                <div class="slider-section">
                    <div class="modern-slider">
                        ${slides}
                        <div style="min-width:10px"></div>
                    </div>
                    <div class="nav-arrow" onclick="scrollSlider(this)"><i class="ph-bold ph-caret-right"></i></div>
                </div>
            `;
        }

        // --- FLUXO PRINCIPAL SIMPLIFICADO ---
        async function initApp() {
            if (appInitialized) return;
            appInitialized = true;
            trackEvent('PageView');
            
            // 1. Cumprimento Cordial (Sem pedir nome)
            await addMessage(`${getGreeting()}! Ol√°, aqui √© o Osvaldo da Cestas B√°sicas Dona Ant√¥nia. üëã`, 'bot', 800);
            await addMessage(`Entregamos em Cuiab√° e V√°rzea Grande:`, 'bot', 800);
            await addMessage(`Conhe√ßa nossas Cestas: üëá`, 'bot', 1200);

            // 2. Mostrar Card Imediatamente
            state.step = 5; 
            nextStep();
        }

        document.addEventListener('DOMContentLoaded', initApp);
        window.addEventListener('load', initApp);
        setTimeout(initApp, 1500); 

        async function handleInput() {
            const text = userInput.value.trim();
            if (!text) return;
            userInput.value = '';
            await addMessage(text, 'user');
            if(state.step === 5) {
                await addMessage("Entendi! Mas antes, veja essa oportunidade:", 'bot', 1000);
                triggerPaymentOffer();
            }
        }

        async function nextStep() {
            if(state.timerRef) clearTimeout(state.timerRef);

            switch (state.step) {
                case 5: // Card Normal (Exibi√ß√£o Imediata)
                    const uniqueIdNormal = 'card-normal-' + Date.now(); // ID √öNICO
                    const cardHTML = `
                        <div class="card-container">
                            <div class="modern-card">
                                <div id="${uniqueIdNormal}">
                                    ${getCardContent(CESTAS[0], uniqueIdNormal)}
                                </div>
                            </div>
                        </div>`;
                    
                    await addMessage(cardHTML, 'bot');
                    trackEvent('ViewContent', { content_name: 'Catalogo', content_type: 'product_group' });
                    
                    // 3. TIMER DE 15 SEGUNDOS (Agora pergunta Pagamento em vez de Desconto direto)
                    state.timerRef = setTimeout(() => { 
                        triggerPaymentOffer();
                    }, 15000); 
                    break;
                
                case 7: // Exibir Formas de Pagamento (NOVO)
                    await addMessage(`Trabalhamos com diversas formas para facilitar:`, 'bot', 1000);
                    
                    const payHTML = `
                        <div class="card-container">
                            <div class="payment-card">
                                <div class="pay-item">
                                    <div class="pay-icon"><i class="ph-bold ph-pix-logo"></i></div>
                                    <div><strong>Pix</strong> <span style="font-size:12px; color:#64748B">(Aprova√ß√£o imediata)</span></div>
                                </div>
                                <div class="pay-item">
                                    <div class="pay-icon"><i class="ph-bold ph-credit-card"></i></div>
                                    <div><strong>Cart√µes</strong> <span style="font-size:12px; color:#64748B">(3x sem juros)</span></div>
                                </div>
                                <div class="pay-item">
                                    <div class="pay-icon"><i class="ph-bold ph-money"></i></div>
                                    <div><strong>Dinheiro</strong> <span style="font-size:12px; color:#64748B">(No ato da entrega)</span></div>
                                </div>
                                <div class="pay-item">
                                    <div class="pay-icon"><i class="ph-bold ph-ticket"></i></div>
                                    <div><strong>Vale Alimenta√ß√£o e Refei√ß√£o</strong> <span style="font-size:12px; color:#64748B">(Verificar bandeiras)</span></div>
                                </div>
                                <div class="pay-item" style="justify-content: center; color: #ef4444; font-weight: 600; font-size: 13px; border:none; padding-top:16px;">
                                    ‚ö†Ô∏è N√£o vendemos "pra 30 dias"
                                </div>
                            </div>
                        </div>
                    `;
                    await addMessage(payHTML, 'bot', 1500);

                    // Gancho para o desconto
                    setTimeout(async () => {
                        await addMessage(`Ah, e tenho uma surpresa para voc√™! üéÅ`, 'bot', 1000);
                        await addMessage(`Consegui um <b>desconto especial</b> nas cestas. Quer aproveitar?`, 'bot', 1200);
                        showOptions([{ text: "Quero o Desconto üéÅ", val: "quero_desc", next: 9 }]);
                    }, 2500);
                    break;

                case 9: // LISTA DE PRE√áOS VIP
                    state.vipMode = true; 
                    await addMessage(`Liberado! üéâ Apliquei o desconto em <b>todas</b> as cestas. Confira a tabela oficial:`, 'bot', 1200);

                    let tableRows = '';
                    CESTAS.forEach((c, i) => {
                        c.opcoes.forEach(opt => {
                             const oldP = opt.valor_num.toFixed(2).replace('.', ',');
                             const newP = (opt.valor_num - c.desconto).toFixed(2).replace('.', ',');
                             const nome = c.opcoes.length > 1 ? `${c.nome} (${opt.arroz})` : c.nome;
                             
                             tableRows += `
                                <tr style="border-bottom: 1px solid #F1F5F9;">
                                    <td style="padding: 8px 10px; color: #1E293B; font-weight:500; font-size: 13px; line-height: 1.2;">${nome}</td>
                                    <td style="padding: 8px 4px; text-align: right; white-space: nowrap; color: #ef4444; text-decoration: line-through; font-size: 11px;">R$ ${oldP}</td>
                                    <td style="padding: 8px 10px 8px 4px; text-align: right; white-space: nowrap; color: #059669; font-weight: 700; font-size: 13px;">R$ ${newP}</td>
                                </tr>
                             `;
                        });
                    });

                    const tableHTML = `
                        <div class="card-container">
                            <div class="modern-card" style="border: 2px solid #F59E0B; overflow: hidden;">
                                <div style="background:#FEF3C7; padding:8px; text-align:center; font-size:11px; font-weight:700; color:#B45309; text-transform:uppercase;">
                                    <i class="ph-fill ph-ticket"></i> Tabela VIP Ativa
                                </div>
                                <table style="width:100%; border-collapse: collapse; font-size: 13px;">
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    
                    await addMessage(tableHTML, 'bot', 1000);

                    await addMessage(`üìù Coloque seu nome na lista de clientes com desconto.`, 'bot', 1500);
                    
                    // Bot√£o Final - Garantir Desconto + Instagram
                    const finalBtnHTML = `
                        <div class="card-container" style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
                             <a href="javascript:void(0)" onclick="openWaGeneric()" class="btn-claim" style="background:#10B981;">
                                POR NOME NA LISTA DE DESCONTO <i class="ph-bold ph-whatsapp-logo" style="font-size:18px"></i>
                            </a>
                            <a href="${CONFIG.instagramLink}" target="_blank" class="btn-claim" style="background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); box-shadow: 0 4px 12px rgba(220, 39, 67, 0.3);">
                                Veja o Instagram da Dona Ant√¥nia <i class="ph-bold ph-instagram-logo" style="font-size:20px"></i>
                            </a>
                        </div>
                    `;
                    await addMessage(finalBtnHTML, 'bot', 500);
                    break;
            }
        }

        // Nova fun√ß√£o de Gatilho de Pagamento
        async function triggerPaymentOffer(instant = false) {
            // Se o usu√°rio j√° passou do passo 5 (j√° clicou em algo), n√£o mostra
            if (state.step > 5) return;

            state.step = 6; 
            
            await addMessage(`Gostaria de Ver as Formas de Pagamento?`, 'bot', 1200);
            
            showOptions([{ text: "Sim", val: "ver_pagto", next: 7 }]);
        }

        const getGreeting = () => {
            const h = new Date().getHours();
            return h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";
        };

        // Fun√ß√£o gen√©rica para o bot√£o final
        window.openWaGeneric = async function() {
            let text = "Ol√°! Vim pelo site e quero garantir os descontos da Lista VIP:\n\n";
            
            CESTAS.forEach(c => {
                text += `üõí *${c.nome}*\n`;
                
                c.opcoes.forEach(opt => {
                     const precoFinal = (opt.valor_num - c.desconto).toFixed(2).replace('.', ',');
                     const label = opt.arroz.includes('Valor') ? 'Valor √önico' : `Com ${opt.arroz}`;
                     text += `üí∞ ${label}: *R$ ${precoFinal}*\n`;
                });

                text += `------------------------------\n`;
            });

            text += "\nQual a disponibilidade?";
            
            window.open(`https://wa.me/${CONFIG.whatsAppNumber}?text=${encodeURIComponent(text)}`, '_blank');
            trackEvent('Lead', { currency: 'BRL', value: 0, content_name: 'Lista VIP Completa' });

            await addMessage("Perfeito! Aguardamos voc√™ no WhatsApp.", 'bot', 1000);
            
            const socialHTML = `
                <div class="social-buttons-container">
                    <a href="${CONFIG.instagramLink}" target="_blank" class="social-btn-lg btn-insta">
                        <i class="ph-bold ph-instagram-logo" style="font-size:24px"></i> 
                        Siga no Instagram
                    </a>
                </div>
            `;
            await addMessage(socialHTML, 'system', 1000);
        }

        sendBtn.onclick = handleInput;
        userInput.onkeypress = (e) => { if(e.key === 'Enter') handleInput(); }

    </script>
</body>
</html>

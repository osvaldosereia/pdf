<!DOCTYPE html>
<html lang="pt-BR" itemscope itemtype="https://schema.org/LocalBusiness">
<head>
    <!-- 
        ================================================================
        PILLAR 1: CORE WEB VITALS & SEO CONFIG
        ================================================================
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta Pequena | Super Cestas Dona Ant√¥nia</title>
    <meta name="description" content="Conhe√ßa a Cesta Pequena Dona Ant√¥nia. Produtos de qualidade com o melhor pre√ßo de Cuiab√° e V√°rzea Grande.">
    <meta name="theme-color" content="#2563EB">
    <meta name="robots" content="noindex, nofollow">

    <!-- PILLAR 3: SECURITY SUITE -->
    <script>
        (function() {
            // DOMAIN LOCK & FRAME BUSTER
            const allowedDomains = ['www.donaantonia.com.br', 'donaantonia.com.br', 'localhost', '127.0.0.1'];
            const currentDomain = window.location.hostname;
            const isPreviewEnv = currentDomain.includes('google') || currentDomain.includes('sandbox') || currentDomain.includes('content') || currentDomain.includes('firebaseapp');
            
            if (!isPreviewEnv && !allowedDomains.some(d => currentDomain.endsWith(d))) {
                console.warn(`‚ö†Ô∏è [SECURITY] Acesso n√£o autorizado.`);
                // window.location.href = 'https://www.donaantonia.com.br'; // Descomente em produ√ß√£o
            }
            if (window.top !== window.self && !isPreviewEnv) {
                window.top.location = window.self.location;
            }
        })();
    </script>

    <!-- PILLAR 2: TRACKING & ANALYTICS -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function trackMarketingEvent(eventName, params = {}) {
            window.dataLayer.push({ 'event': eventName, ...params });
            if (typeof fbq === 'function') fbq('track', eventName, params);
            console.log(`%c[PIXEL] ${eventName}`, "background:#0f172a;color:#22c55e;padding:2px 5px;", params);
        }
    </script>

    <!-- LIBS -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #2563EB;
            --bg-color: #E2E8F0; 
            --text-main: #1E293B;
            --text-sub: #64748B;
            --white: #ffffff;
            --bubble-bot: #ffffff;
            --bubble-user: #2563EB;
            --text-user: #ffffff;
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0 auto; padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
            display: flex; flex-direction: column;
            max-width: 480px; width: 100%; height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .modern-header {
            background-color: var(--white); height: 70px; padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid #CBD5E1; flex-shrink: 0; z-index: 10;
        }
        .brand-logo { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .brand-info h1 { font-size: 15px; font-weight: 700; margin: 0; }
        .status-badge { font-size: 11px; color: #10B981; background: #D1FAE5; padding: 2px 8px; border-radius: 12px; }

        /* CHAT AREA */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px;
            background-color: var(--bg-color); scroll-behavior: smooth;
        }

        .msg-row { display: flex; width: 100%; margin-bottom: 16px; animation: slideUp 0.3s ease; }
        .msg-start { justify-content: flex-start; }
        .msg-end { justify-content: flex-end; }
        
        .msg-bubble {
            padding: 14px 16px; max-width: 85%; font-size: 15px; line-height: 1.5;
            position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .msg-in { background: var(--white); color: var(--text-main); border-radius: 18px 18px 18px 4px; }
        .msg-out { background: var(--primary); color: white; border-radius: 18px 18px 4px 18px; }

        /* IMAGE MESSAGE */
        .msg-image {
            width: 100%; border-radius: 12px; margin-top: 8px;
            display: block; pointer-events: none; /* Anti-Copy */
        }

        /* PRODUCT GRID (UNBOXING EFFECT) */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px; /* Menor gap para caber mais imagem */
            width: 100%;
            margin-top: 10px;
        }

        .mini-card {
            background: #F8FAFC; border: 1px solid #E2E8F0;
            border-radius: 8px; 
            padding: 4px; /* Padding m√≠nimo */
            text-align: center;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            animation: fadeInScale 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            height: 120px; /* Altura fixa ligeiramente maior */
            overflow: hidden;
        }

        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .mini-card img {
            width: 100%; 
            height: 80px; /* Altura for√ßada para imagem grande */
            object-fit: contain;
            mix-blend-mode: multiply;
            flex-shrink: 0;
        }
        
        .mini-card span { 
            font-size: 10px; line-height: 1.1; 
            color: var(--text-sub); font-weight: 600; 
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            margin-top: 2px;
        }
        
        .count-badge {
            background: var(--primary); color: white;
            font-size: 9px; padding: 2px 6px; border-radius: 10px;
            position: absolute; top: 4px; left: 4px; z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mini-card { position: relative; } /* Para posicionar o badge */

        /* BUTTONS */
        .action-btn {
            background: var(--white); border: 1px solid #CBD5E1; color: var(--primary);
            font-weight: 700; padding: 12px 24px; border-radius: 12px;
            cursor: pointer; margin-top: 8px; width: 100%;
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .action-btn:active { transform: scale(0.96); background: #F1F5F9; }
        .action-btn.primary { background: var(--primary); color: white; border: none; }

        /* TYPING INDICATOR */
        .typing { display: flex; gap: 4px; padding: 10px; }
        .dot { width: 6px; height: 6px; background: #94A3B8; border-radius: 50%; animation: bounce 1.4s infinite; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* FOOTER INPUT */
        #input-footer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 16px; border-top: 1px solid #E2E8F0;
            display: flex; gap: 10px; max-width: 480px; margin: 0 auto;
        }
        .modern-input {
            flex: 1; background: #F1F5F9; border: 1px solid #CBD5E1;
            padding: 12px; border-radius: 24px; outline: none;
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <header class="modern-header">
        <div style="display:flex; align-items:center; gap:10px;">
            <img src="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" 
                 class="brand-logo" alt="Logo"
                 onerror="this.src='https://placehold.co/40x40/2563EB/ffffff?text=DA'">
            <div class="brand-info">
                <h1>Dona Ant√¥nia</h1>
                <span class="status-badge">Online agora</span>
            </div>
        </div>
        <i class="ph ph-dots-three-vertical" style="font-size: 24px; color: var(--text-sub);"></i>
    </header>

    <main id="chat-container">
        <!-- Chat Flow Starts Here -->
    </main>

    <footer id="input-footer">
        <input type="text" class="modern-input" placeholder="Responder..." disabled>
        <button style="background:var(--primary); color:white; border:none; width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
            <i class="ph-fill ph-paper-plane-right" style="font-size:20px;"></i>
        </button>
    </footer>

    <script>
        // --- DATA & LOGIC ---

        const CESTA_PEQUENA_ITEMS = [
            { name: "Arroz Koblenz 5kg", qtd: 2, type: "alimento" },
            { name: "A√ß√∫car Doce Dia 2kg", qtd: 1, type: "alimento" },
            { name: "√ìleo de Soja Liza 900ml", qtd: 2, type: "alimento" },
            { name: "Feij√£o Da Casa 1kg", qtd: 2, type: "alimento" },
            { name: "Caf√© Caboclo 250g", qtd: 1, type: "alimento" },
            { name: "Ovos (D√∫zia)", qtd: 1, type: "alimento" },
            { name: "Bolo Apti Chocolate", qtd: 1, type: "alimento" },
            { name: "Espaguete QDelicia", qtd: 1, type: "alimento" },
            { name: "Trigo Vitoriosa 1kg", qtd: 1, type: "alimento" },
            { name: "Sal 1kg", qtd: 1, type: "alimento" },
            { name: "Molho Fugini 340g", qtd: 1, type: "alimento" },
            { name: "Milho Verde Predileta", qtd: 1, type: "alimento" },
            { name: "Tempero Tio Jonas", qtd: 1, type: "alimento" },
            { name: "Bolacha MyBit", qtd: 2, type: "alimento" },
            { name: "Miojo Apti", qtd: 2, type: "alimento" },
            { name: "Suco Frisco", qtd: 2, type: "alimento" },
            { name: "Sab√£o Barra Ype", qtd: 1, type: "limpeza" },
            { name: "Creme Dental Sorriso", qtd: 1, type: "limpeza" },
            { name: "Papel Higi√™nico", qtd: 1, type: "limpeza" },
            { name: "Amaciante Ype 2L", qtd: 1, type: "limpeza" },
            { name: "Desinfetante Remmus", qtd: 1, type: "limpeza" },
            { name: "Sab√£o em P√≥ OMO", qtd: 1, type: "limpeza" },
            { name: "Detergente Ype", qtd: 2, type: "limpeza" },
            { name: "Qboa 1 Litro", qtd: 1, type: "limpeza" },
            { name: "Sabonete Palmolive", qtd: 2, type: "limpeza" },
            { name: "L√£ de A√ßo Assolan", qtd: 1, type: "limpeza" },
            { name: "Esponja", qtd: 1, type: "limpeza" }
        ];

        function getProductImage(text) {
            const t = text.toLowerCase();
            const folderAlimento = 'img/alimento/';
            const folderLimpeza = 'img/limpeza/';
            const placeholder = `https://placehold.co/100x100/f1f5f9/334155?text=${encodeURIComponent(text.split(' ')[0])}`;
            
            if(t.includes('arroz')) return folderAlimento + 'Arroz Koblenz 5kg.webp';
            if(t.includes('a√ß√∫car')) return folderAlimento + 'a√ßucar doce dia 2 kg.webp';
            if(t.includes('oleo') || t.includes('√≥leo')) return folderAlimento + 'oleo de soja liza.webp';
            if(t.includes('feij√£o')) return folderAlimento + 'feij√£o da casa.webp';
            if(t.includes('caf√©')) return folderAlimento + 'cafe caboclo 250g.webp';
            if(t.includes('ovo')) return folderAlimento + 'ovo duzia.jpg';
            if(t.includes('bolo')) return folderAlimento + 'bolo apti chocolate.webp';
            if(t.includes('espaguete')) return folderAlimento + 'espaguete qdelicia.webp';
            if(t.includes('trigo')) return folderAlimento + 'trigo vitoriosa.webp';
            if(t.includes('sal')) return folderAlimento + 'sal.webp';
            if(t.includes('molho')) return folderAlimento + 'molho fugini.webp';
            if(t.includes('milho')) return folderAlimento + 'milho verde predileta.webp';
            if(t.includes('tempero')) return folderAlimento + 'tempero tio jonas.jpg';
            if(t.includes('bolacha')) return folderAlimento + 'bolacha mybit.webp';
            if(t.includes('miojo')) return folderAlimento + 'miojo apti.webp';
            if(t.includes('suco')) return folderAlimento + 'suco frisco.webp';
            // Limpeza
            if(t.includes('sab√£o barra')) return folderLimpeza + 'sab√£o barra ype 900g.webp';
            if(t.includes('creme dental')) return folderLimpeza + 'Creme Dental Sorriso 70g.webp';
            if(t.includes('papel')) return folderLimpeza + 'papel higienico.webp';
            if(t.includes('amaciante')) return folderLimpeza + 'amaciante ype 2L.webp';
            if(t.includes('desinfetante')) return folderLimpeza + 'Desinfetante Remmus 2L.webp';
            if(t.includes('sab√£o em p√≥') || t.includes('omo')) return folderLimpeza + 'sab√£o em p√≥ omo 800g.webp';
            if(t.includes('detergente')) return folderLimpeza + 'Detergente Ype 500ml.webp';
            if(t.includes('qboa')) return folderLimpeza + 'Qboa 1 Litro.webp';
            if(t.includes('sabonete')) return folderLimpeza + 'sabonete palmolive 85g.webp';
            if(t.includes('l√£')) return folderLimpeza + 'l√£ de a√ßo assolan.webp';
            if(t.includes('esponja')) return folderLimpeza + 'esponja de lavar lou√ßa.webp';

            return placeholder;
        }

        const chatContainer = document.getElementById('chat-container');

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addMessage(content, type = 'bot', delay = 800) {
            return new Promise(resolve => {
                if(type === 'bot') {
                    const typingId = 'typing-' + Date.now();
                    chatContainer.insertAdjacentHTML('beforeend', `
                        <div id="${typingId}" class="msg-row msg-start">
                            <div class="msg-bubble msg-in typing">
                                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                            </div>
                        </div>
                    `);
                    scrollToBottom();

                    setTimeout(() => {
                        document.getElementById(typingId).remove();
                        appendFinalMessage();
                    }, delay);
                } else {
                    appendFinalMessage();
                }

                function appendFinalMessage() {
                    const html = `
                        <div class="msg-row ${type === 'bot' ? 'msg-start' : 'msg-end'}">
                            <div class="msg-bubble ${type === 'bot' ? 'msg-in' : 'msg-out'}">
                                ${content}
                            </div>
                        </div>
                    `;
                    chatContainer.insertAdjacentHTML('beforeend', html);
                    scrollToBottom();
                    resolve();
                }
            });
        }

        function addAction(text, callbackId) {
            const btnId = 'btn-' + Date.now();
            const html = `<button id="${btnId}" class="action-btn" onclick="handleAction('${btnId}', '${text}', ${callbackId})">${text}</button>`;
            chatContainer.lastElementChild.querySelector('.msg-bubble').insertAdjacentHTML('beforeend', html);
            scrollToBottom();
        }

        async function handleAction(btnId, text, callbackId) {
            document.getElementById(btnId).remove();
            await addMessage(text, 'user', 0);
            
            if (callbackId === 1) flowStartShowcase();
            if (callbackId === 2) flowStartGridAnimation();
            if (callbackId === 3) flowRedirectWhatsApp();
        }

        async function initFlow() {
            await new Promise(r => setTimeout(r, 1000));
            
            const greeting = new Date().getHours() < 12 ? "Bom dia" : "Boa tarde";
            await addMessage(`${greeting}! Sou o assistente virtual da Dona Ant√¥nia.`);
            
            await addMessage(`Essa √© a nossa <b>Cesta Pequena</b>, uma das mais completas: <br>
                <img src="cesta pequena.jpg" class="msg-image" alt="Cesta Pequena" onerror="this.src='https://placehold.co/400x300/e2e8f0/2563EB?text=Foto+Cesta+Pequena'">
            `, 'bot', 1200);

            await addMessage(`Voc√™ quer ver todos os produtos que est√£o nessa cesta?`);
            addAction("Quero sim üëç", 1);
        }

        async function flowStartShowcase() {
            trackMarketingEvent('InitiateCheckout', { content_name: 'Showcase Cesta Pequena' });
            await addMessage(`Ok, vou enviar 1 por 1 para voc√™ conferir, pode ser?`);
            addAction("Ok, pode mandar", 2);
        }

        async function flowStartGridAnimation() {
            const gridId = 'live-grid-' + Date.now();
            await addMessage(`Aqui est√£o os produtos: <div id="${gridId}" class="grid-container"></div>`, 'bot', 500);
            
            const gridEl = document.getElementById(gridId);
            
            let flatItems = [];
            CESTA_PEQUENA_ITEMS.forEach(item => {
                for(let i=0; i < item.qtd; i++) {
                    flatItems.push({ ...item, isMulti: item.qtd > 1 });
                }
            });

            let index = 0;
            function showNextItem() {
                if (index >= flatItems.length) {
                    setTimeout(flowOfferDiscount, 1500);
                    return;
                }

                const item = flatItems[index];
                const img = getProductImage(item.name);
                
                // Card HTML Otimizado
                const card = `
                    <div class="mini-card">
                        ${item.isMulti ? `<div class="count-badge">${index+1}</div>` : ''}
                        <img src="${img}" alt="${item.name}">
                        <span>${item.name.replace(/\d+(kg|ml|g|L)/gi, '')}</span>
                    </div>
                `;

                // BEFOREEND: Adiciona no final (vai preenchendo as linhas de cima para baixo)
                gridEl.insertAdjacentHTML('beforeend', card);
                
                // SCROLL SUAVE: Rola para baixo para acompanhar os novos itens
                chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });

                index++;
                setTimeout(showNextItem, 600); 
            }

            showNextItem();
        }

        async function flowOfferDiscount() {
            await addMessage(`Gostou? Bastante coisa n√©? üòç`);
            await addMessage(`Tenho uma condi√ß√£o especial para hoje.`);
            await addMessage(`Quer ativar o <b>DESCONTO VIP</b> para que o pre√ßo dela fique por apenas <b>R$ 205,00</b>?`);
            
            const btnId = 'btn-desc-' + Date.now();
            const html = `
                <button id="${btnId}" class="action-btn primary" onclick="handleAction('${btnId}', 'Sim, quero o desconto! üéÅ', 3)">
                    SIM, ATIVAR DESCONTO
                </button>
            `;
            chatContainer.lastElementChild.querySelector('.msg-bubble').insertAdjacentHTML('beforeend', html);
            scrollToBottom();
        }

        async function flowRedirectWhatsApp() {
            trackMarketingEvent('Lead', { 
                value: 205.00, 
                currency: 'BRL', 
                content_name: 'Cesta Pequena Desconto VIP' 
            });

            await addMessage(`Legal! üéâ`);
            await addMessage(`Vou te direcionar para o nosso WhatsApp para colocar seu nome na lista e finalizar o pedido.`);
            
            setTimeout(() => {
                const text = "Ol√°! Vim pelo site e quero a *Cesta Pequena* com o desconto de R$ 205,00.";
                const phone = "5565998150975";
                window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
            }, 2500);
        }

        window.addEventListener('load', initFlow);

    </script>
</body>
</html>

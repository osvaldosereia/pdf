<!DOCTYPE html>
<html lang="pt-BR" itemscope itemtype="https://schema.org/LocalBusiness">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta Econ√¥mica | Super Cestas Dona Ant√¥nia</title>
    <meta name="description" content="Cestas b√°sicas com qualidade e pre√ßo justo em Cuiab√° e V√°rzea Grande. Pe√ßa pelo WhatsApp!">
    <meta name="theme-color" content="#2563EB">
    
    <!-- OPEN GRAPH (Pilar 2: Otimiza√ß√£o de CTR Social) -->
    <meta property="og:title" content="Super Cestas Dona Ant√¥nia">
    <meta property="og:description" content="Garanta sua cesta b√°sica com o melhor pre√ßo da regi√£o.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:image" content="https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif">

    <!-- PILLAR 3: SECURITY & ANTI-CLONE PROTOCOL -->
    <script>
        (function() {
            // Lista de dom√≠nios permitidos (White-label)
            const allowedDomains = ['www.donaantonia.com.br', 'donaantonia.com.br', 'localhost', '127.0.0.1'];
            const currentDomain = window.location.hostname;
            // Permite ambientes de preview do Google/Codesandbox para desenvolvimento
            const isPreviewEnv = currentDomain.includes('google') || currentDomain.includes('sandbox') || currentDomain.includes('content');
            
            const isAllowed = allowedDomains.some(d => currentDomain === d || currentDomain.endsWith('.' + d)) || isPreviewEnv;

            if (!isAllowed) {
                console.warn(`‚ö†Ô∏è [SECURITY] Acesso via dom√≠nio n√£o autorizado: ${currentDomain}. Redirecionamento preventivo recomendado em produ√ß√£o.`);
                // Em produ√ß√£o real, descomente a linha abaixo:
                // window.location.href = 'https://www.donaantonia.com.br';
            }
        })();
    </script>

    <!-- SCHEMA MARKUP (Pilar 1: Google Local SEO - JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "GroceryStore",
      "name": "Super Cestas Dona Ant√¥nia",
      "image": "https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif",
      "telephone": "+5565998150975",
      "priceRange": "$$",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Av. Principal do Coxip√≥",
        "addressLocality": "Cuiab√°",
        "addressRegion": "MT",
        "postalCode": "78000-000",
        "addressCountry": "BR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -15.6014, 
        "longitude": -56.0979
      },
      "openingHoursSpecification": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        "opens": "08:00",
        "closes": "18:00"
      },
      "sameAs": [
        "https://instagram.com/cestas.dona.antonia.cuiaba.vg",
        "https://facebook.com/cestas.dona.antonia"
      ]
    }
    </script>

    <!-- Performance: Preconnect & Icons -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* === MODERN MINIMALIST THEME === */
        :root {
            --primary: #2563EB;
            --primary-dark: #1d4ed8;
            --primary-light: #EFF6FF;
            --bg-color: #E2E8F0; 
            --text-main: #1E293B;
            --text-sub: #64748B;
            --white: #ffffff;
            --bubble-bot: #ffffff;
            --bubble-user: #2563EB;
            --text-user: #ffffff;
            --shadow-sm: 0 1px 3px 0 rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --radius-bubble: 18px;
            --radius-card: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* PERFORMANCE & LAYOUT FIX */
        html {
            background-color: #cbd5e1;
            height: 100%;
        }

        body {
            height: 100%; 
            margin: 0 auto;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow: hidden;
            display: flex; flex-direction: column;
            max-width: 480px; 
            width: 100%;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .modern-header {
            background-color: var(--white);
            height: 70px;
            padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid #CBD5E1;
            z-index: 100; flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .brand-area { display: flex; align-items: center; gap: 12px; }
        .brand-logo { 
            width: 42px; height: 42px; 
            border-radius: 50%;
            object-fit: cover; box-shadow: var(--shadow-sm); 
        }
        .brand-info h1 { font-size: 16px; font-weight: 700; margin: 0; color: var(--text-main); }
        .status-badge { 
            display: inline-flex; align-items: center; gap: 6px; 
            font-size: 12px; color: #10B981; font-weight: 500; 
            background: #D1FAE5; padding: 4px 8px; border-radius: 20px; 
        }
        .status-dot { width: 8px; height: 8px; background: #10B981; border-radius: 50%; }

        /* CHAT AREA */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 20px;
            background-color: var(--bg-color);
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* MESSAGES */
        .msg-row { 
            display: flex; width: 100%; margin-bottom: 16px; 
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
        }
        .msg-start { justify-content: flex-start; }
        .msg-end { justify-content: flex-end; }
        .msg-center { justify-content: center; margin-bottom: 12px; }

        .msg-bubble {
            padding: 14px 18px;
            max-width: 88%;
            font-size: 15px; line-height: 1.5;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .msg-bubble:has(.card-container) {
            max-width: 95%;
            width: 100%;
            padding: 0;
            background: transparent;
            box-shadow: none;
        }

        .msg-in { 
            background-color: var(--bubble-bot); 
            color: var(--text-main);
            border-radius: var(--radius-bubble);
            border-bottom-left-radius: 4px;
        }
        
        .msg-out { 
            background-color: var(--bubble-user); 
            color: var(--text-user);
            border-radius: var(--radius-bubble);
            border-bottom-right-radius: 4px;
        }

        .msg-time { 
            display: block; text-align: right; 
            font-size: 10px; margin-top: 4px; opacity: 0.7; 
        }

        /* ANIMATIONS */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-dot { 
            width: 6px; height: 6px; background: #94A3B8; 
            border-radius: 50%; display: inline-block; 
            animation: typing 1.4s infinite; margin: 0 2px; 
        }
        @keyframes typing { 0%,100%{transform:scale(0.8);opacity:0.5} 50%{transform:scale(1.2);opacity:1} }

        /* INPUT AREA (HIDDEN PER REQUEST) */
        #input-footer {
            background-color: var(--white);
            padding: 16px 20px;
            border-top: 1px solid #CBD5E1;
            display: none; /* ESCONDIDO */
            align-items: center; gap: 12px;
            flex-shrink: 0; padding-bottom: max(16px, env(safe-area-inset-bottom));
        }

        .modern-input {
            flex: 1; background: #F1F5F9; border-radius: 30px;
            padding: 14px 20px; border: 1px solid #CBD5E1;
            font-size: 16px; color: var(--text-main); outline: none;
            transition: all 0.2s;
        }
        .modern-input:focus { background: var(--white); border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }

        .send-btn-modern {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--primary); color: white; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: transform 0.2s;
            box-shadow: 0 4px 10px rgba(37,99,235,0.3);
        }
        .send-btn-modern:active { transform: scale(0.92); }

        /* OPTIONS BUTTONS */
        .msg-options { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 5px; }
        
        .modern-btn {
            background: var(--white); border: 1px solid #CBD5E1;
            color: var(--primary); font-weight: 600; font-size: 15px;
            padding: 16px; border-radius: 16px; cursor: pointer;
            text-align: left; width: 100%; transition: all 0.2s;
            display: flex; flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .modern-btn:active { background: #F8FAFC; transform: scale(0.98); }
        .btn-sub { font-size: 12px; color: var(--text-sub); font-weight: 400; margin-top: 4px; }

        /* === MODERN CARDS === */
        .card-container { 
            width: 100%; 
            max-width: 100%;
            margin-bottom: 10px; 
        }
        
        .modern-card {
            background: var(--white);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid #CBD5E1;
        }

        .card-header-img {
            position: relative;
            height: 280px; 
            background: #F8FAFC;
            display: flex; 
            justify-content: flex-start;
            align-items: center;
            padding: 20px;
            padding-right: 90px;
        }
        
        .card-img-main {
            width: auto; height: auto;
            max-width: 100%; max-height: 240px; 
            object-fit: contain; 
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.1));
            transition: transform 0.3s ease;
            pointer-events: none; 
            -webkit-user-select: none;
            display: block;
            margin-right: auto;
        }
        
        .selo-modern {
            position: absolute; top: 16px; left: 16px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(4px);
            padding: 6px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; color: #B45309;
            box-shadow: var(--shadow-sm); border: 1px solid #FEF3C7;
            z-index: 2; 
        }

        /* CHIPS NAVIGATION */
        .chips-float {
            position: absolute; right: 16px; top: 50%; 
            transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 8px;
            max-height: 90%; overflow-y: auto; padding: 4px;
            z-index: 5; min-width: 80px;
        }
        .chip-modern {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            padding: 8px 12px; background: rgba(255,255,255,0.9);
            backdrop-filter: blur(4px); border-radius: 12px;
            border: 1px solid #E2E8F0; color: var(--text-sub);
            cursor: pointer; text-align: center;
            transition: all 0.2s; box-shadow: var(--shadow-sm);
        }
        .chip-modern.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(37,99,235,0.25);
        }

        /* PRODUCT SLIDER */
        .slider-section {
            padding: 16px 0; background: #fff;
            border-bottom: 1px solid #F1F5F9;
            position: relative;
        }
        .modern-slider {
            display: flex; gap: 12px; overflow-x: auto; padding: 0 20px;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
        }
        .modern-slider::-webkit-scrollbar { display: none; }
        
        .slide-item {
            flex: 0 0 130px;
            background: #F8FAFC; border-radius: 16px;
            padding: 8px 4px;
            text-align: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid transparent;
        }
        .slide-item img { 
            width: 105px; height: 105px;
            object-fit: contain; margin-bottom: 6px; 
            mix-blend-mode: multiply;
        }
        .slide-qty { font-size: 11px; font-weight: 700; color: var(--primary); }
        .slide-name { font-size: 11px; color: var(--text-sub); line-height: 1.3; }

        .nav-arrow {
            position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
            width: 36px; height: 36px; 
            background: #F59E0B; color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
            cursor: pointer; z-index: 10;
        }

        /* PRICE SECTION */
        .price-section { padding: 20px; background: white; }
        .price-row { 
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; font-size: 14px; color: var(--text-sub);
        }
        .price-val { font-weight: 700; color: var(--text-main); font-size: 16px; }

        /* DISCOUNT WIDGET */
        .modern-discount {
            background: white; border-radius: var(--radius-card); border: 1px solid #E2E8F0;
            padding: 24px; text-align: center; box-shadow: var(--shadow-sm);
        }
        .discount-highlight {
            background: #ECFDF5; border: 1px dashed #10B981; border-radius: 16px;
            padding: 16px; margin-bottom: 16px;
        }
        .discount-big { font-size: 36px; font-weight: 800; color: #059669; display: block; margin: 4px 0; }
        .discount-label { font-size: 12px; color: #059669; font-weight: 600; text-transform: uppercase; }
        
        .btn-claim {
            width: 100%; padding: 16px; border-radius: 16px;
            background: var(--primary); color: white; font-weight: 700; border: none;
            font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 12px rgba(37,99,235,0.3); transition: transform 0.2s;
        }
        .btn-claim:active { transform: scale(0.97); }

        /* SOCIAL BUTTONS */
        .social-buttons-container {
            display: flex; flex-direction: column; gap: 12px;
            padding: 10px 20px;
            width: 100%;
        }
        .social-btn-lg {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; padding: 16px;
            border-radius: 50px;
            font-size: 16px; font-weight: 700;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .social-btn-lg:active { transform: scale(0.96); }
        
        .btn-insta { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; }
        .btn-vip { background: #25D366; color: white; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="modern-header">
        <div class="brand-area">
            <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" 
                 class="brand-logo" 
                 alt="Logo Dona Antonia"
                 onerror="this.src='https://api.dicebear.com/7.x/initials/svg?seed=DA&backgroundColor=2563EB&textColor=ffffff'">
            <div class="brand-info">
                <h1>Cesta B√°sica Dona Ant√¥nia</h1>
                <div class="status-badge">
                    <div class="status-dot"></div> <span id="status-text">Online</span>
                </div>
            </div>
        </div>
        <div style="display:flex; gap:16px; color:var(--text-sub); font-size:22px;">
            <i class="ph ph-dots-three-vertical"></i>
        </div>
    </header>

    <!-- CHAT -->
    <main id="chat-container">
        <!-- Messages will appear here -->
    </main>

    <!-- FOOTER -->
    <footer id="input-footer">
        <input type="text" id="user-input" class="modern-input" placeholder="Escreva uma mensagem..." autocomplete="off">
        <button id="send-btn" class="send-btn-modern" aria-label="Enviar">
            <i class="ph-fill ph-paper-plane-right"></i>
        </button>
    </footer>

    <script>
        // === L√ìGICA DE NEG√ìCIO & TRACKING ===
        
        window.dataLayer = window.dataLayer || [];
        function trackEvent(eventName, params = {}) {
            window.dataLayer.push({ 'event': eventName, ...params });
            console.log(`%c[MARKETING PIXEL] Event: ${eventName}`, "background: #22c55e; color: #fff; padding: 2px 5px; border-radius: 3px;", params);
        }

        const CONFIG = {
            ownerName: "Osvaldo",
            whatsAppGroupLink: "https://chat.whatsapp.com/IOI3gSBLRVk4jGK2QMunp1",
            whatsAppNumber: "5565998150975", 
            whatsAppSaveNumber: "5565998150975",
            instagramLink: "https://www.instagram.com/cestas.dona.antonia.cuiaba.vg/"
        };

        const CESTAS = [
            {
                id: 'economica', nome: 'Cesta Econ√¥mica', destaque: 'Mais Vendida', desconto: 5, arrozQtd: 1, brindeNome: '1 Trigo 1kg',
                brindeImg: 'img/alimento/trigo vitoriosa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-economica.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '1 √ìleo de Soja Liza 900ml', '1 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Farinha de Mandioca Dona De 1Kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '1 Suco Frisco'],
                opcoes: [{ arroz: 'Valor √önico', preco: '85,00', valor_num: 85.00 }]
            },
            {
                id: 'mini', nome: 'Cesta Mini', desconto: 10, arrozQtd: 1, brindeNome: '1 Feij√£o 1kg',
                brindeImg: 'img/alimento/feij√£o da casa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-mini.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '1 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '165,00', valor_num: 165.00 }, { arroz: 'Koblenz', preco: '170,00', valor_num: 170.00 }]
            },
            {
                id: 'pequena', nome: 'Cesta Pequena', desconto: 15, arrozQtd: 2, brindeNome: '1 Amaciante 2L',
                brindeImg: 'img/limpeza/amaciante ype 2L.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-pequena.avif',
                items: ['2 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '215,00', valor_num: 215.00 }, { arroz: 'Koblenz', preco: '220,00', valor_num: 220.00 }]
            },
            {
                id: 'media', nome: 'Cesta M√©dia', desconto: 20, arrozQtd: 3, brindeNome: '1 Caf√© 250g',
                brindeImg: 'img/alimento/cafe caboclo 250g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-media.avif',
                items: ['3 Arroz Koblenz 5kg', '2 A√ß√∫car Doce Dia 2kg', '3 √ìleo de Soja Liza 900ml', '3 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '2 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '3 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '3 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '320,00', valor_num: 320.00 }, { arroz: 'Koblenz', preco: '325,00', valor_num: 325.00 }]
            },
            {
                id: 'grande', nome: 'Cesta Grande', desconto: 25, arrozQtd: 4, brindeNome: '1 OMO 800g',
                brindeImg: 'img/limpeza/sab√£o em p√≥ omo 800g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-grande.avif',
                items: ['4 Arroz Koblenz 5kg', '3 A√ß√∫car Doce Dia 2kg', '4 √ìleo de Soja Liza 900ml', '4 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '3 Espaguete QDelicia 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '4 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '4 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '380,00', valor_num: 380.00 }, { arroz: 'Koblenz', preco: '390,00', valor_num: 390.00 }]
            }
        ];

        // --- SISTEMA DE IMAGENS INTELIGENTE ---
        function getProductImage(text) {
            const t = text.toLowerCase();
            const folderAlimento = 'img/alimento/';
            const folderLimpeza = 'img/limpeza/';
            const placeholder = `https://placehold.co/100x100/f1f5f9/334155?text=${text.split(' ')[0]}`;

            if(t.includes('arroz')) return folderAlimento + 'Arroz Koblenz 5kg.webp';
            if(t.includes('a√ß√∫car') || t.includes('acucar')) return folderAlimento + 'a√ßucar doce dia 2 kg.webp';
            if(t.includes('bolacha')) return folderAlimento + 'bolacha mybit.webp';
            if(t.includes('bolo')) return folderAlimento + 'bolo apti chocolate.webp';
            if(t.includes('caf√©') || t.includes('cafe')) return t.includes('500g') ? folderAlimento + 'cafe caboclo 500g.webp' : folderAlimento + 'cafe caboclo 250g.webp';
            if(t.includes('espaguete') || t.includes('macarr√£o')) return folderAlimento + 'espaguete qdelicia.webp';
            if(t.includes('farinha')) return folderAlimento + 'farinha de mandioca.webp';
            if(t.includes('feij√£o') || t.includes('feijao')) return folderAlimento + 'feij√£o da casa.webp';
            if(t.includes('milho')) return folderAlimento + 'milho verde predileta.webp';
            if(t.includes('miojo')) return folderAlimento + 'miojo apti.webp';
            if(t.includes('molho')) return folderAlimento + 'molho fugini.webp';
            if(t.includes('oleo') || t.includes('√≥leo')) return folderAlimento + 'oleo de soja liza.webp';
            if(t.includes('ovo')) return folderAlimento + 'ovo duzia.jpg';
            if(t.includes('sal')) return folderAlimento + 'sal.webp';
            if(t.includes('suco')) return folderAlimento + 'suco frisco.webp';
            if(t.includes('tempero')) return folderAlimento + 'tempero tio jonas.jpg';
            if(t.includes('trigo')) return folderAlimento + 'trigo vitoriosa.webp';

            if(t.includes('creme dental')) return folderLimpeza + 'Creme Dental Sorriso 70g.webp';
            if(t.includes('desinfetante')) return folderLimpeza + 'Desinfetante Remmus 2L.webp';
            if(t.includes('detergente')) return folderLimpeza + 'Detergente Ype 500ml.webp';
            if(t.includes('qboa') || t.includes('sanit√°ria')) return folderLimpeza + 'Qboa 1 Litro.webp';
            if(t.includes('amaciante')) return folderLimpeza + 'amaciante ype 2L.webp';
            if(t.includes('papel hig')) return folderLimpeza + 'papel higienico.webp';
            if(t.includes('sabonete')) return folderLimpeza + 'sabonete palmolive 85g.webp';
            if(t.includes('sab√£o')) return t.includes('barra') ? folderLimpeza + 'sab√£o barra ype 900g.webp' : folderLimpeza + 'sab√£o em p√≥ omo 800g.webp';
            if(t.includes('esponja')) return folderLimpeza + 'esponja de lavar lou√ßa.webp';
            if(t.includes('l√£') || t.includes('aco')) return folderLimpeza + 'l√£ de a√ßo assolan.webp';

            return placeholder;
        }

        // --- SISTEMA DE CHAT ---
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusText = document.getElementById('status-text');
        const inputFooter = document.getElementById('input-footer');

        let state = { step: 0, userName: '', selectedDiscountId: null, timerRef: null };
        let appInitialized = false;

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addMessage(text, type = 'bot', delayOverride = null) {
            return new Promise(resolve => {
                let delay = 1200; 
                if (type === 'bot') {
                    const isCard = text.includes('modern-card') || text.includes('modern-discount') || text.includes('company-modern');
                    if (isCard) { delay = 1500; } 
                    else { delay = Math.min(text.length * 40 + 600, 3500); }
                } else { delay = 0; }

                if (delayOverride !== null) delay = delayOverride;
                
                setTimeout(() => {
                    if (type === 'bot') {
                        statusText.innerText = 'Digitando...';
                        const id = 'typing-' + Date.now();
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div id="${id}" class="msg-row msg-start">
                                <div class="msg-bubble msg-in">
                                    <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();

                        const typingTime = (text.includes('modern-card')) ? 1500 : delay; 
                        
                        setTimeout(() => {
                            const el = document.getElementById(id);
                            if(el) el.remove();
                            
                            const isComplex = text.includes('card-container') || text.includes('modern-discount');
                            const bubbleStyle = isComplex ? 'padding:0; background:transparent; box-shadow:none; max-width:100%; width:100%;' : '';

                            chatContainer.insertAdjacentHTML('beforeend', `
                                <div class="msg-row msg-start" style="${isComplex ? 'width:100%' : ''}">
                                    <div class="msg-bubble msg-in" style="${bubbleStyle}">
                                        ${text}
                                        ${!isComplex ? `<span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>` : ''}
                                    </div>
                                </div>
                            `);
                            statusText.innerText = 'Online';
                            scrollToBottom();
                            resolve();
                        }, typingTime);
                    } 
                    else if (type === 'system') {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-center">
                                ${text}
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                    else {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-end">
                                <div class="msg-bubble msg-out">
                                    ${text}
                                </div>
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                }, type === 'user' ? 0 : 500);
            });
        }

        function showOptions(opts) {
            setTimeout(() => {
                const id = 'opts-' + Date.now();
                const btns = opts.map(o => `
                    <button class="modern-btn" onclick="handleOpt('${o.val}', ${o.next}, '${id}', '${o.text}')">
                        ${o.text}
                        ${o.sub ? `<span class="btn-sub">${o.sub}</span>` : ''}
                    </button>
                `).join('');
                
                chatContainer.insertAdjacentHTML('beforeend', `
                    <div id="${id}" class="msg-options">${btns}</div>
                `);
                scrollToBottom();
            }, 800);
        }

        window.handleOpt = async function(val, next, id, text) {
            document.getElementById(id).remove();
            
            // Se o usu√°rio interagiu, cancela o timer autom√°tico de 15s
            if(state.timerRef) clearTimeout(state.timerRef);
            
            await addMessage(text, 'user');
            
            if (val.startsWith('basket_')) {
                const idx = parseInt(val.split('_')[1]);
                state.selectedDiscountId = CESTAS[idx].id;
            }
            
            state.step = next;
            nextStep();
        };

        window.selectBasketChip = function(idx) {
            const container = document.getElementById('unified-card-content');
            if(!container) return;
            container.style.opacity = '0.5';
            setTimeout(() => {
                container.innerHTML = getCardContent(CESTAS[idx]);
                container.style.opacity = '1';
            }, 150);
        };

        window.scrollSlider = function(btn) {
            const wrapper = btn.parentElement;
            const slider = wrapper.querySelector('.modern-slider');
            if(slider) {
                slider.scrollBy({ left: 220, behavior: 'smooth' });
            }
        };

        function getCardContent(cesta) {
            const chips = CESTAS.map((c, i) => `
                <div class="chip-modern ${c.id === cesta.id ? 'active' : ''}" onclick="selectBasketChip(${i})">
                    ${c.nome.replace('Cesta ', '')}
                </div>
            `).join('');

            const slides = cesta.items.map(item => {
                const match = item.match(/^(\d+)\s+(.*)$/);
                let qty = "1 un", nome = item;
                if(match) { qty = match[1] + (parseInt(match[1]) > 1 ? ' un' : ' un'); nome = match[2]; }
                
                const imgPath = getProductImage(nome);
                
                return `
                <div class="slide-item">
                    <img src="${imgPath}" loading="lazy" alt="${nome}" onerror="this.src='https://placehold.co/60x60/f1f5f9/94a3b8?text=IMG'">
                    <span class="slide-qty">${qty}</span>
                    <span class="slide-name">${nome}</span>
                </div>`;
            }).join('');

            const precos = cesta.opcoes.map(o => `
                <div class="price-row">
                    <span>${o.arroz.includes('Valor') ? 'Valor √önico' : 'Com ' + o.arroz}</span>
                    <span class="price-val">R$ ${o.preco}</span>
                </div>
            `).join('');

            const absoluteUrl = cesta.img;
            const localFallback = 'img/' + absoluteUrl.split('/').pop();

            return `
                <div class="card-header-img">
                    ${cesta.destaque ? `<div class="selo-modern"><i class="ph-fill ph-star"></i> ${cesta.destaque}</div>` : ''}
                    <img src="${absoluteUrl}" 
                         class="card-img-main" 
                         alt="${cesta.nome}" 
                         onerror="this.onerror=null;this.src='${localFallback}';">
                    <div class="chips-float">${chips}</div>
                </div>
                
                <div class="price-section" style="border-bottom: 1px solid #F1F5F9; padding-bottom: 10px;">
                    ${precos}
                </div>

                <div class="slider-section">
                    <div class="modern-slider">
                        ${slides}
                        <div style="min-width:10px"></div>
                    </div>
                    <div class="nav-arrow" onclick="scrollSlider(this)"><i class="ph-bold ph-caret-right"></i></div>
                </div>
            `;
        }

        // --- FLUXO PRINCIPAL SIMPLIFICADO ---
        async function initApp() {
            if (appInitialized) return;
            appInitialized = true;
            trackEvent('PageView');
            
            // 1. Cumprimento Cordial (Sem pedir nome)
            await addMessage(`${getGreeting()}! Ol√°, aqui √© o Osvaldo da Cestas B√°sicas Dona Ant√¥nia. üëã`, 'bot', 800);
            await addMessage(`Entregamos em Cuiab√° e V√°rzea Grande:`, 'bot', 800);
            await addMessage(`Conhe√ßa nossas Cestas: üëá`, 'bot', 1200);

            // 2. Mostrar Card Imediatamente
            state.step = 5; // Pula direto para passo de exibi√ß√£o
            nextStep();
        }

        document.addEventListener('DOMContentLoaded', initApp);
        window.addEventListener('load', initApp);
        setTimeout(initApp, 1500); 

        async function handleInput() {
            const text = userInput.value.trim();
            if (!text) return;
            userInput.value = '';
            await addMessage(text, 'user');
            // Fluxo gen√©rico se usu√°rio digitar algo fora dos bot√µes
            if(state.step === 5) {
                // Se ele digitar enquanto v√™ as cestas, podemos direcionar para o desconto
                await addMessage("Entendi! Mas antes, veja essa oportunidade:", 'bot', 1000);
                triggerDiscountOffer();
            }
        }

        async function nextStep() {
            if(state.timerRef) clearTimeout(state.timerRef);

            switch (state.step) {
                case 5: // Card Cesta Moderno (Exibi√ß√£o Imediata)
                    const cardHTML = `
                        <div class="card-container">
                            <div class="modern-card">
                                <div id="unified-card-content">
                                    ${getCardContent(CESTAS[0])}
                                </div>
                            </div>
                        </div>`;
                    
                    await addMessage(cardHTML, 'bot');
                    trackEvent('ViewContent', { content_name: 'Catalogo', content_type: 'product_group' });
                    
                    // 3. TIMER DE 15 SEGUNDOS (Gatilho de Reten√ß√£o)
                    state.timerRef = setTimeout(() => { 
                        triggerDiscountOffer();
                    }, 15000); 
                    break;
                
                // Passo intermedi√°rio criado pelo bot√£o do Timer
                case 8: // Oferecer Desconto
                    triggerDiscountOffer(true); // true = chamado via bot√£o se houvesse, mas aqui √© fluxo direto
                    break;

                case 9: // Sele√ß√£o da Cesta para o Desconto
                    await addMessage(`Legal! Pra qual cesta voc√™ quer aplicar o Desconto?`, 'bot', 1000);
                    const opts = CESTAS.map((c, i) => ({
                        text: c.nome.replace('Cesta ', ''),
                        sub: `(${c.arrozQtd} Arroz)`,
                        val: `basket_${i}`,
                        next: 10
                    }));
                    showOptions(opts);
                    break;

                case 10: // Exibir Cupom e Link WhatsApp
                    const selected = CESTAS.find(c => c.id === state.selectedDiscountId) || CESTAS[0];
                    await addMessage(`Boa escolha! Para a <b>${selected.nome}</b>, liberei isso:`, 'bot', 1200);
                    
                    const discountHTML = `
                        <div class="card-container">
                            <div class="modern-discount">
                                <div class="discount-highlight">
                                    <span class="discount-label">DESCONTO EXCLUSIVO</span>
                                    <span class="discount-big">- R$ ${selected.desconto},00</span>
                                    <span style="font-size:11px; color:#059669; opacity:0.8">V√°lido por 30 dias</span>
                                </div>
                                <button class="btn-claim" onclick="openWa('${selected.nome}', ${selected.desconto})">
                                    GARANTIR AGORA <i class="ph-bold ph-whatsapp-logo"></i>
                                </button>
                                <p style="font-size:11px; color:#94A3B8; margin-top:12px">Sem compromisso de compra hoje.</p>
                            </div>
                        </div>
                    `;
                    await addMessage(discountHTML, 'bot');
                    await addMessage("Clique acima para garantir o desconto no WhatsApp. üëÜ", 'bot', 1200);
                    break;
            }
        }

        // Fun√ß√£o separada para o gatilho de 15s
        async function triggerDiscountOffer(instant = false) {
            // Se o usu√°rio j√° passou do passo 5 (j√° clicou em algo), n√£o mostra
            if (state.step > 8) return;

            state.step = 8; // Atualiza estado para evitar loops
            
            if(!instant) {
                await addMessage(`üôè Espero que tenha gostado.`, 'bot', 1000);
            }
            await addMessage(`üéÅ Tenho um **desconto especial** para voc√™ fazer!`, 'bot', 1200);
            
            showOptions([{ text: "Quero meu Desconto üéÅ", val: "quero_desc", next: 9 }]);
        }

        const getGreeting = () => {
            const h = new Date().getHours();
            return h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";
        };

        window.openWa = async function(cesta, desconto) {
            // Mensagem simplificada (sem nome do usu√°rio, pois n√£o capturamos)
            const msg = `Ol√°! Tenho interesse na *${cesta}* e quero garantir meu desconto de *R$ ${desconto},00*.`;
            
            window.open(`https://wa.me/${CONFIG.whatsAppNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            trackEvent('Lead', { currency: 'BRL', value: desconto, content_name: cesta });

            await addMessage("Muito obrigado! üôè", 'bot', 1000);
            await addMessage("Somos uma empresa familiar que trabalha com muito amor para entregar a melhor cesta b√°sica de Mato Grosso.", 'bot', 1500);
            
            await addMessage("Acompanhe nossas novidades: üëá", 'bot', 1000);
            
            const socialHTML = `
                <div class="social-buttons-container">
                    <a href="${CONFIG.instagramLink}" target="_blank" class="social-btn-lg btn-insta">
                        <i class="ph-bold ph-instagram-logo" style="font-size:24px"></i> 
                        Siga no Instagram
                    </a>
                    <a href="${CONFIG.whatsAppGroupLink}" target="_blank" class="social-btn-lg btn-vip">
                        <i class="ph-bold ph-star" style="font-size:24px"></i> 
                        Entre no Grupo VIP
                    </a>
                </div>
            `;
            await addMessage(socialHTML, 'system', 1000);
        }

        sendBtn.onclick = handleInput;
        userInput.onkeypress = (e) => { if(e.key === 'Enter') handleInput(); }

    </script>
</body>
</html>

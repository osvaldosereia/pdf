<!DOCTYPE html>
<html lang="pt-BR" itemscope itemtype="https://schema.org/LocalBusiness">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cesta Econ√¥mica | Super Cestas Dona Ant√¥nia - Cuiab√° e VG</title>
    <meta name="description" content="Encomende cestas b√°sicas em Cuiab√° e V√°rzea Grande. Qualidade, pre√ßo justo e entrega r√°pida. Fale com o Osvaldo!">
    <meta name="theme-color" content="#008069">
    
    <!-- PILLAR 1: SCHEMA MARKUP -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "GroceryStore",
      "name": "Super Cestas Dona Ant√¥nia",
      "image": "https://donaantonia.com.br/img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif",
      "telephone": "+5565998150975",
      "url": "https://donaantonia.com.br",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Cuiab√°",
        "addressRegion": "MT",
        "addressCountry": "BR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -15.6014, 
        "longitude": -56.0979
      },
      "priceRange": "$$"
    }
    </script>

    <!-- FONTS & ICONS -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- PILLAR 3: SECURITY HEADERS -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:;">
    <meta http-equiv="X-Frame-Options" content="DENY">

    <style>
        /* === CSS NATIVO (BLINDADO E RICO) === */
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            height: 100%; margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #E5DDD5;
            overflow: hidden;
            display: flex; flex-direction: column;
            /* REMOVIDO: visibilidade oculta que causava tela branca */
        }

        /* HEADER */
        .wa-header {
            background-color: #008069; color: white; height: 60px; padding: 0 10px;
            display: flex; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 100; flex-shrink: 0;
        }

        .header-avatar {
            width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; position: relative;
            background: #ccc; border: 1px solid rgba(255,255,255,0.3);
        }
        .header-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .header-status-dot {
            position: absolute; bottom: 0; right: 0; width: 12px; height: 12px;
            background-color: #4ade80; border: 2px solid white; border-radius: 50%;
        }
        .header-info { flex: 1; overflow: hidden; }
        .header-title { font-weight: bold; font-size: 17px; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .header-subtitle { font-size: 12px; color: rgba(255,255,255,0.85); }
        .header-actions { display: flex; gap: 15px; font-size: 20px; }
        .header-actions a { color: white; text-decoration: none; }

        /* CHAT AREA */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 15px; background-color: #E5DDD5;
            background-image: url("data:image/svg+xml,%3Csvg width='320' height='180' viewBox='0 0 320 180' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239CAFA3' fill-opacity='0.20' fill-rule='evenodd'%3E%3Ctext x='20' y='70' font-family='Arial, sans-serif' font-size='24' font-weight='bold' transform='rotate(-8 20 70)'%3Ewww.donaantonia.com.br%3C/text%3E%3Ctext x='80' y='150' font-family='Arial, sans-serif' font-size='24' font-weight='bold' transform='rotate(-8 80 150)'%3E65 99815-0975%3C/text%3E%3C/g%3E%3C/svg%3E");
            -webkit-overflow-scrolling: touch;
        }

        .msg-row { display: flex; width: 100%; margin-bottom: 8px; animation: fadeIn 0.3s ease; }
        .msg-start { justify-content: flex-start; }
        .msg-end { justify-content: flex-end; }

        .msg-bubble {
            padding: 8px 12px; border-radius: 7.5px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
            max-width: 85%; font-size: 15px; line-height: 19px; position: relative; color: #111b21;
        }
        .msg-in { background-color: #fff; border-top-left-radius: 0; }
        .msg-out { background-color: #d9fdd3; border-top-right-radius: 0; }
        .msg-time { float: right; font-size: 11px; color: #667781; margin-top: 5px; margin-left: 10px; display: flex; align-items: center; }

        /* FOOTER */
        #input-footer {
            background-color: #f0f2f5; padding: 8px 10px; display: flex; align-items: center; gap: 8px; flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom, 10px);
        }
        .input-box { flex: 1; background: white; border-radius: 20px; padding: 9px 15px; display: flex; align-items: center; box-shadow: inset 0 0 0 1px #fff; }
        .input-box input { border: none; outline: none; width: 100%; font-size: 16px; background: transparent; }
        .send-btn {
            width: 45px; height: 45px; background-color: #008069; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;
            cursor: pointer; border: none; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .send-btn:active { transform: scale(0.95); }

        /* OPTIONS */
        .msg-options { display: flex; flex-direction: column; gap: 8px; width: 85%; margin-bottom: 10px; }
        .wa-btn {
            background: white; color: #008069; border: 1px solid #f0f0f0; padding: 12px;
            border-radius: 8px; text-align: center; font-size: 15px; font-weight: 600; cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .wa-btn-subtitle { display: block; font-size: 11px; font-weight: 400; color: #54656f; margin-top: 2px; }

        /* CARD UNIFICADO */
        .card-msg-container { width: 100%; max-width: 95%; margin-bottom: 5px; }
        .card-cesta-new {
            background: #fff; border-radius: 16px; border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; display: flex; flex-direction: column; position: relative;
        }
        .card-top-row { display: flex; height: 180px; border-bottom: 1px solid #f5f5f5; }
        .card-img-area { flex: 1; padding: 10px; display: flex; align-items: center; justify-content: center; position: relative; }
        .card-img-large { width: 150px; height: 150px; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15)); }
        
        .card-chips-area {
            width: 95px; background: #f8f9fa; border-left: 1px solid #eee; padding: 8px 5px;
            display: flex; flex-direction: column; gap: 8px; overflow-y: auto; justify-content: center;
        }
        .chip-nav {
            font-size: 11px; padding: 6px 2px; border-radius: 4px; text-align: center; cursor: pointer;
            border: 1px solid #e0e0e0; background: white; color: #666; font-weight: bold; text-transform: uppercase;
        }
        .chip-nav.selected { background: #008069; color: white; border-color: #006d59; box-shadow: 0 2px 4px rgba(0,128,105,0.2); }

        .selo-destaque {
            position: absolute; top: 10px; left: 10px;
            background: linear-gradient(135deg, #ffb300, #FFB300); color: #0F2546; padding: 3px 8px;
            border-radius: 20px; font-weight: 800; font-size: 10px; text-transform: uppercase; z-index: 10;
        }

        /* SLIDER */
        .product-slider-container { background: #f9fafb; padding: 10px 0; width: 100%; border-bottom: 1px solid #eee; position: relative; }
        .slider-wrapper { position: relative; }
        .product-slider { display: flex; overflow-x: auto; gap: 8px; padding: 0 10px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .product-slider::-webkit-scrollbar { display: none; }
        
        .product-slide {
            flex: 0 0 100px; min-height: 130px;
            background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 4px;
            text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .product-slide img { width: 70px; height: 70px; object-fit: contain; margin-bottom: 6px; }
        .product-qty { font-size: 12px; font-weight: 800; color: #0d5f46; margin-bottom: 2px; }
        .product-name { font-size: 10px; color: #666; font-weight: 500; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.1; }

        .slider-arrow-indicator {
            position: absolute; right: 2px; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.9); border: 2px solid #25D366; border-radius: 50%;
            width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); pointer-events: none; animation: bounceRight 1.5s infinite;
        }

        /* PRICES */
        .card-price-display-only { padding: 10px; background: #fff; }
        .price-item-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 4px; color: #555; }
        .price-item-row strong { color: #ff5252; }

        /* DISCOUNT */
        .discount-container { background: #fff; border-radius: 8px; padding: 15px; border: 1px solid #e0e0e0; text-align: center; margin-bottom: 10px; }
        .discount-box { background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .discount-val { font-size: 32px; font-weight: bold; color: #166534; display: block; margin: 5px 0; }
        .cta-btn {
            width: 100%; background: #008069; color: white; font-weight: bold; font-size: 16px;
            padding: 14px; border: none; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .cta-btn:active { transform: scale(0.98); }

        /* COMPANY CARD */
        .company-header { padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #eee; gap: 15px; }
        .company-logo { width: 65px; height: 65px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .company-stats-list { display: flex; flex-direction: column; gap: 8px; padding: 12px; }
        .stat-row { display: flex; align-items: center; padding: 10px; border-radius: 8px; color: white; font-size: 13px; font-weight: 500; }
        
        .social-container { padding: 10px; text-align: center; }
        .social-btn {
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white; padding: 12px 20px; border-radius: 50px; text-decoration: none;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: bold; margin: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .group-btn {
            background: linear-gradient(to right, #eab308, #ca8a04);
            color: white; padding: 12px 20px; border-radius: 50px; text-decoration: none;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            font-weight: bold; margin: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* UTILS */
        .hidden { display: none; }
        .typing-dot { width: 6px; height: 6px; background: #999; border-radius: 50%; display: inline-block; animation: typing 1.4s infinite; margin: 0 2px; }
        @keyframes typing { 0%,100%{transform:scale(0.8);opacity:0.5} 50%{transform:scale(1.2);opacity:1} }
        @keyframes fadeIn { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }
        @keyframes bounceRight { 0%,100%{transform:translate(0,-50%)} 50%{transform:translate(5px,-50%)} }
        .text-link { color: #008069; font-weight: bold; text-decoration: none; }
        .text-link:hover { text-decoration: underline; }
        .list-disc { padding-left: 20px; margin: 0; text-align: left; font-size: 14px; line-height: 1.5; color: #444; }

    </style>
</head>
<body>
    <header class="wa-header">
        <div class="header-avatar">
            <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=Osvaldo&backgroundColor=c0aede'" alt="Osvaldo">
            <div class="header-status-dot"></div>
        </div>
        <div class="header-info">
            <div class="header-title">Cestas Dona Ant√¥nia</div>
            <div id="status-text" class="header-subtitle">Online</div>
        </div>
        <div class="header-actions">
            <a href="https://instagram.com" target="_blank"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://wa.me/5565998150975" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
    </header>

    <main id="chat-container">
        <!-- JS injeta mensagens aqui -->
    </main>

    <footer id="input-footer">
        <div class="input-box">
            <input type="text" id="user-input" placeholder="Digite seu nome..." autocomplete="off">
        </div>
        <button id="send-btn" class="send-btn">
            <i class="fa-solid fa-paper-plane"></i>
        </button>
    </footer>

    <script>
        // === L√ìGICA DE NEG√ìCIO RESTAURADA ===
        
        window.dataLayer = window.dataLayer || [];
        function trackEvent(eventName, params = {}) {
            window.dataLayer.push({ 'event': eventName, ...params });
        }

        const CONFIG = {
            ownerName: "Osvaldo",
            whatsAppGroupLink: "https://chat.whatsapp.com/IOI3gSBLRVk4jGK2QMunp1",
            whatsAppNumber: "5565998150975",
            whatsAppSaveNumber: "5565998150965",
            instagramLink: "https://instagram.com/cestas.dona.antonia.cuiaba.vg"
        };

        // DADOS ORIGINAIS E COMPLETOS RESTAURADOS
        const CESTAS = [
            {
                id: 'economica', nome: 'Cesta Econ√¥mica', destaque: 'Mais Vendida', desconto: 5, arrozQtd: 1, brindeNome: '1 Trigo 1kg',
                brindeImg: 'img/alimento/trigo vitoriosa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-economica.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '1 √ìleo de Soja Liza 900ml', '1 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Farinha de Mandioca Dona De 1Kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '1 Suco Frisco'],
                opcoes: [{ arroz: 'Valor √önico', preco: '85,00', valor_num: 85.00 }]
            },
            {
                id: 'mini', nome: 'Cesta Mini', desconto: 10, arrozQtd: 1, brindeNome: '1 Feij√£o 1kg',
                brindeImg: 'img/alimento/feij√£o da casa.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-mini.avif',
                items: ['1 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '1 Espaguete QDelicia 500g', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Bolacha MyBit Recheada', '1 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '1 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '165,00', valor_num: 165.00 }, { arroz: 'Koblenz', preco: '170,00', valor_num: 170.00 }]
            },
            {
                id: 'pequena', nome: 'Cesta Pequena', desconto: 15, arrozQtd: 2, brindeNome: '1 Amaciante 2L',
                brindeImg: 'img/limpeza/amaciante ype 2L.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-pequena.avif',
                items: ['2 Arroz Koblenz 5kg', '1 A√ß√∫car Doce Dia 2kg', '2 √ìleo de Soja Liza 900ml', '2 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 250g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '1 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '2 Suco Frisco', '1 Sab√£o Barra Ype 900g', '1 Creme Dental Sorriso 70g', '1 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '2 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '215,00', valor_num: 215.00 }, { arroz: 'Koblenz', preco: '220,00', valor_num: 220.00 }]
            },
            {
                id: 'media', nome: 'Cesta M√©dia', desconto: 20, arrozQtd: 3, brindeNome: '1 Caf√© 250g',
                brindeImg: 'img/alimento/cafe caboclo 250g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-media.avif',
                items: ['3 Arroz Koblenz 5kg', '2 A√ß√∫car Doce Dia 2kg', '3 √ìleo de Soja Liza 900ml', '3 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '2 Espaguete QDelicia 500g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '3 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '3 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '320,00', valor_num: 320.00 }, { arroz: 'Koblenz', preco: '325,00', valor_num: 325.00 }]
            },
            {
                id: 'grande', nome: 'Cesta Grande', desconto: 25, arrozQtd: 4, brindeNome: '1 OMO 800g',
                brindeImg: 'img/limpeza/sab√£o em p√≥ omo 800g.webp',
                img: 'https://donaantonia.com.br/img/cesta-basica-cuiaba-varzea-grande-grande.avif',
                items: ['4 Arroz Koblenz 5kg', '3 A√ß√∫car Doce Dia 2kg', '4 √ìleo de Soja Liza 900ml', '4 Feij√£o Da Casa 1kg', '1 Caf√© Caboclo 500g', '3 Espaguete QDelicia 500g', '12 Ovos', '1 Bolo Apti Chocolate 400g', '1 Trigo Vitoriosa 1kg', '1 Sal 1kg', '2 Molho Fugini 340g', '1 Milho Verde Predileta', '1 Tempero Tio Jonas', '2 Bolacha MyBit Recheada', '2 Miojo Apti', '4 Suco Frisco', '1 Sab√£o Barra Ype 900g', '2 Creme Dental Sorriso 70g', '2 Papel Higi√™nico', '1 Amaciante Ype 2L', '1 Desinfetante Remmus 2L', '1 Sab√£o em P√≥ OMO 800g', '2 Detergente Ype 500ml', '1 Qboa 1 Litro', '4 Sabonete Palmolive 85g', '1 L√£ de A√ßo Assolan', '1 Esponja de Lavar Lou√ßa'],
                opcoes: [{ arroz: 'Tio Alvino', preco: '380,00', valor_num: 380.00 }, { arroz: 'Koblenz', preco: '390,00', valor_num: 390.00 }]
            }
        ];

        // LOGICA DE IMAGENS DETALHADA RESTAURADA
        function getProductImage(text) {
            const lowerText = text.toLowerCase();
            let imgName = 'outros.png';
            let folder = 'img/alimento/';

            if(lowerText.includes('creme dental')) { imgName = 'Creme Dental Sorriso 70g.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('desinfetante')) { imgName = 'Desinfetante Remmus 2L.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('detergente')) { imgName = 'Detergente Ype 500ml.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('qboa')) { imgName = 'Qboa 1 Litro.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('amaciante')) { imgName = 'amaciante ype 2L.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('esponja de lavar lou√ßa')) { imgName = 'esponja de lavar lou√ßa.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('l√£ de a√ßo') || lowerText.includes('assolan')) { imgName = 'l√£ de a√ßo assolan.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('papel higi√™nico') || lowerText.includes('papel higienico')) { imgName = 'papel higienico.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('sabonete')) { imgName = 'sabonete palmolive 85g.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('sab√£o barra')) { imgName = 'sab√£o barra ype 900g.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('sab√£o p√≥') || lowerText.includes('sab√£o em p√≥') || lowerText.includes('omo')) { imgName = 'sab√£o em p√≥ omo 800g.webp'; folder = 'img/limpeza/'; }
            else if(lowerText.includes('arroz')) imgName = 'Arroz Koblenz 5kg.webp';
            else if(lowerText.includes('a√ß√∫car') || lowerText.includes('acucar')) imgName = 'a√ßucar doce dia 2 kg.webp';
            else if(lowerText.includes('bolacha')) imgName = 'bolacha mybit.webp';
            else if(lowerText.includes('bolo')) imgName = 'bolo apti chocolate.webp';
            else if(lowerText.includes('caf√©') || lowerText.includes('cafe')) {
                if(lowerText.includes('500g')) imgName = 'cafe caboclo 500g.webp';
                else imgName = 'cafe caboclo 250g.webp';
            }
            else if(lowerText.includes('espaguete')) imgName = 'espaguete qdelicia.webp';
            else if(lowerText.includes('farinha') || lowerText.includes('mandioca')) imgName = 'farinha de mandioca.webp';
            else if(lowerText.includes('feij√£o') || lowerText.includes('feijao')) imgName = 'feij√£o da casa.webp';
            else if(lowerText.includes('milho')) imgName = 'milho verde predileta.webp';
            else if(lowerText.includes('miojo')) imgName = 'miojo apti.webp';
            else if(lowerText.includes('molho')) imgName = 'molho fugini.webp';
            else if(lowerText.includes('oleo') || lowerText.includes('√≥leo')) imgName = 'oleo de soja liza.webp';
            else if(lowerText.includes('ovo')) imgName = 'ovo duzia.jpg';
            else if(lowerText.includes('sal')) imgName = 'sal.webp';
            else if(lowerText.includes('suco')) imgName = 'suco frisco.webp';
            else if(lowerText.includes('tempero')) imgName = 'tempero tio jonas.jpg';
            else if(lowerText.includes('trigo')) imgName = 'trigo vitoriosa.webp';

            return `${folder}${imgName}`;
        }

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const statusText = document.getElementById('status-text');
        const inputFooter = document.getElementById('input-footer');

        let state = { step: 0, userName: '', selectedDiscountId: null, timerRef: null };
        let appInitialized = false;

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        function addMessage(text, type = 'bot', delayOverride = null) {
            return new Promise(resolve => {
                let delay = 600;
                if (type === 'bot') {
                    const isCard = text.includes('card-cesta') || text.includes('discount-container') || text.includes('company-header');
                    if (isCard) {
                        delay = 600; 
                    } else {
                        delay = Math.min(text.length * 20 + 300, 1500);
                    }
                } else {
                    delay = 0;
                }

                if (delayOverride !== null) delay = delayOverride;
                
                setTimeout(() => {
                    if (type === 'bot') {
                        statusText.innerText = 'Digitando...';
                        const id = 'typing-' + Date.now();
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div id="${id}" class="msg-row msg-start">
                                <div class="msg-bubble msg-in">
                                    <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();

                        const typingTime = (text.includes('card-cesta') || text.includes('discount-container')) ? 800 : delay; 
                        
                        setTimeout(() => {
                            const el = document.getElementById(id);
                            if(el) el.remove();
                            
                            const isComplex = text.includes('card-cesta') || text.includes('discount-container') || text.includes('company-header');
                            const bubbleStyle = isComplex ? 'padding:0; background:transparent; box-shadow:none; max-width:100%;' : '';

                            chatContainer.insertAdjacentHTML('beforeend', `
                                <div class="msg-row msg-start">
                                    <div class="msg-bubble msg-in" style="${bubbleStyle}">
                                        ${text}
                                        ${!isComplex ? `<span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>` : ''}
                                    </div>
                                </div>
                            `);
                            statusText.innerText = 'Online';
                            scrollToBottom();
                            resolve();
                        }, typingTime);
                    } else {
                        chatContainer.insertAdjacentHTML('beforeend', `
                            <div class="msg-row msg-end">
                                <div class="msg-bubble msg-out">
                                    ${text}
                                    <span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} <i class="fa-solid fa-check-double" style="color:#53bdeb; margin-left:3px;"></i></span>
                                </div>
                            </div>
                        `);
                        scrollToBottom();
                        resolve();
                    }
                }, type === 'user' ? 0 : 200);
            });
        }

        function showOptions(opts) {
            setTimeout(() => {
                const id = 'opts-' + Date.now();
                const btns = opts.map(o => `
                    <button class="wa-btn" onclick="handleOpt('${o.val}', ${o.next}, '${id}', '${o.text}')">
                        ${o.text}
                        ${o.sub ? `<span class="wa-btn-subtitle">${o.sub}</span>` : ''}
                    </button>
                `).join('');
                
                chatContainer.insertAdjacentHTML('beforeend', `
                    <div id="${id}" class="msg-row msg-start">
                        <div class="msg-options">${btns}</div>
                    </div>
                `);
                scrollToBottom();
            }, 400);
        }

        window.handleOpt = async function(val, next, id, text) {
            document.getElementById(id).remove();
            await addMessage(text, 'user');
            
            if (val.startsWith('basket_')) {
                const idx = parseInt(val.split('_')[1]);
                state.selectedDiscountId = CESTAS[idx].id;
            }
            
            state.step = next;
            nextStep();
        };

        window.selectBasketChip = function(idx) {
            const container = document.getElementById('unified-card-content');
            if(!container) return;
            container.style.opacity = '0.5';
            setTimeout(() => {
                container.innerHTML = getCardContent(CESTAS[idx]);
                container.style.opacity = '1';
            }, 150);
        };

        function getCardContent(cesta) {
            const chips = CESTAS.map((c, i) => `
                <div class="chip-nav ${c.id === cesta.id ? 'selected' : ''}" onclick="selectBasketChip(${i})">
                    ${c.nome.replace('Cesta ', '')}
                </div>
            `).join('');

            const slides = cesta.items.map(item => {
                const match = item.match(/^(\d+)\s+(.*)$/);
                let qty = "1 un", nome = item;
                if(match) { qty = match[1] + (parseInt(match[1]) > 1 ? ' un' : ' un'); nome = match[2]; }
                const img = getProductImage(nome);
                
                return `
                <div class="product-slide">
                    <img src="${img}" onerror="this.src='https://placehold.co/60x60/f3f4f6/999?text=IMG'" loading="lazy">
                    <span class="product-qty">${qty}</span>
                    <span class="product-name">${nome}</span>
                </div>`;
            }).join('');

            const precos = cesta.opcoes.map(o => `
                <div class="price-item-row">
                    <span>${o.arroz.includes('Valor') ? 'Valor √önico' : 'Com ' + o.arroz}</span>
                    <strong>R$ ${o.preco}</strong>
                </div>
            `).join('');

            return `
                <div class="card-top-row">
                    <div class="card-img-area">
                        ${cesta.destaque ? `<div class="selo-destaque">${cesta.destaque}</div>` : ''}
                        <img src="${cesta.img}" class="card-img-large" alt="${cesta.nome}">
                    </div>
                    <div class="card-chips-area">${chips}</div>
                </div>
                <div class="product-slider-container">
                    <div class="slider-wrapper">
                        <div class="product-slider">
                            ${slides}
                            <div style="min-width:10px"></div>
                        </div>
                        <div class="slider-arrow-indicator"><i class="fa-solid fa-chevron-right text-green-600"></i></div>
                    </div>
                </div>
                <div class="card-price-display-only">
                    ${precos}
                </div>
            `;
        }

        // --- FLUXO PRINCIPAL RESTAURADO ---
        async function initApp() {
            if (appInitialized) return;
            appInitialized = true;
            // REMOVED HIDING STYLES
            // document.body.style.visibility = 'visible';
            // document.body.style.opacity = '1';
            trackEvent('PageView');
            
            await addMessage(`${getGreeting()}! Tudo bem? üëã`, 'bot', 400);
            await addMessage(`Aqui √© o <b>${CONFIG.ownerName}</b>, da Cesta B√°sica Dona Ant√¥nia.`, 'bot', 800);
            await addMessage(`Qual √© o seu nome?`, 'bot', 600);
        }

        // Trigger faster
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
        
        setTimeout(initApp, 1500); // Fail-safe

        async function handleInput() {
            const text = userInput.value.trim();
            if (!text) return;
            
            if (state.step === 0) {
                state.userName = text.split(' ')[0];
                state.step = 1;
                userInput.value = '';
                inputFooter.style.display = 'none';
                await addMessage(text, 'user');
                nextStep();
            }
        }

        async function nextStep() {
            const name = state.userName;
            if(state.timerRef) clearTimeout(state.timerRef);

            switch (state.step) {
                case 1:
                    await addMessage(`Prazer, ${name}! üòÄ`, 'bot', 600);
                    await addMessage(`Voc√™ j√° conhece nossas cestas?`, 'bot', 800);
                    showOptions([
                        { text: "Sim, j√° conhe√ßo üëç", val: "sim", next: 3 },
                        { text: "N√£o conhe√ßo ü§î", val: "nao", next: 2 }
                    ]);
                    break;
                
                case 2: // Mostra Empresa
                    const stats = [
                        {icon: 'fa-clock', txt: '8 anos em Cuiab√° e VG', color: '#10b981'},
                        {icon: 'fa-truck', txt: '+30 mil Entregas', color: '#3b82f6'},
                        {icon: 'fa-thumbs-up', txt: '6 mil seguidores (Face)', color: '#8b5cf6'},
                        {icon: 'fa-instagram', txt: '1.9k seguidores (Insta)', color: '#E1306C'}
                    ].map(s => `
                        <div class="stat-row" style="background:${s.color}">
                            <i class="fa-brands ${s.icon}" style="margin-right:8px"></i> ${s.txt}
                        </div>
                    `).join('');
                    
                    const companyHTML = `
                        <div class="card-msg-container">
                        <div class="card-cesta-new">
                            <div class="company-header">
                                <img src="img/logo-super-cesta-basica-dona-antonia-cuiaba-varzea-grande.avif" class="company-logo" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=Osvaldo'">
                                <div>
                                    <h3 style="margin:0; font-size:16px; color:#0f2546;">Dona Ant√¥nia</h3>
                                    <p style="margin:0; font-size:13px; color:#666;">Desde 2016</p>
                                </div>
                            </div>
                            <div class="company-stats-list">${stats}</div>
                        </div>
                        </div>
                    `;
                    await addMessage(companyHTML, 'bot', 1000);
                    setTimeout(() => { state.step = 4; nextStep(); }, 4000);
                    break;

                case 3: 
                case 4:
                    await addMessage(state.step === 3 ? "Vou te mostrar as op√ß√µes ent√£o." : "Posso mostrar as cestas agora?", 'bot', 800);
                    showOptions([{ text: "Ver Cestas ‚úÖ", val: "ok", next: 5 }]);
                    break;

                case 5: // Card Interativo
                    await addMessage(`Navegue pelas op√ß√µes abaixo üëá`, 'bot', 600);
                    const cardHTML = `
                        <div class="card-msg-container">
                            <div class="card-cesta-new">
                                <div id="unified-card-content">
                                    ${getCardContent(CESTAS[0])}
                                </div>
                            </div>
                        </div>`;
                    
                    await addMessage(cardHTML, 'bot');
                    trackEvent('ViewContent', { content_name: 'Catalogo' });
                    
                    // Timer de seguran√ßa caso o usu√°rio n√£o clique em nada
                    state.timerRef = setTimeout(() => { 
                        if(state.step === 5) {
                            state.step = 6; 
                            nextStep();
                        }
                    }, 15000);
                    break;

                case 6: // Pergunta Pagamento
                    await addMessage(`Gostou de alguma? Posso te mostrar como funciona o pagamento?`, 'bot', 800);
                    showOptions([{ text: "Pode mostrar üëç", val: "pay", next: 7 }]);
                    break;
                
                case 7: // Mostra Pagamento
                    await addMessage(`Aceitamos praticamente tudo:`, 'bot', 600);
                    const payHTML = `
                        <ul class="list-disc" style="background:#fff; padding:15px 15px 15px 35px; border-radius:8px; box-shadow:0 1px 1px rgba(0,0,0,0.1);">
                            <li>Cart√£o de D√©bito</li>
                            <li>Cart√£o de Cr√©dito em at√© 3x sem juros</li>
                            <li>PIX ou Dinheiro</li>
                            <li>Vale Alimenta√ß√£o e Refei√ß√£o (Alelo, Sodexo, Pluxee, Caju, Flash e Ifood)</li>
                            <li style="font-weight:bold; color:#d32f2f; margin-top:5px;">AINDA N√ÉO VENDEMOS A PRAZO</li>
                        </ul>
                    `;
                    await addMessage(payHTML, 'bot');
                    setTimeout(() => { state.step = 8; nextStep(); }, 4500);
                    break;

                case 8: // Hook
                    await addMessage(`‚≠ê ${name}, quero muito que voc√™ se torne nosso cliente.`, 'bot', 800);
                    await addMessage(`üöÄ Posso te oferecer um desconto pra sua primeira compra?`, 'bot', 800);
                    showOptions([{ text: "Quero Desconto üéÅ", val: "sim", next: 9 }]);
                    break;

                case 9:
                    await addMessage(`Que √≥timo! Qual tamanho de cesta te interessa mais?`, 'bot', 600);
                    const opts = CESTAS.map((c, i) => ({
                        text: c.nome.replace('Cesta ', ''),
                        sub: `(${c.arrozQtd} Arroz)`,
                        val: `basket_${i}`,
                        next: 10
                    }));
                    showOptions(opts);
                    break;

                case 10: // Desconto
                    const selected = CESTAS.find(c => c.id === state.selectedDiscountId);
                    await addMessage(`Boa escolha! Para a <b>${selected.nome}</b>, liberei isso:`, 'bot', 800);
                    
                    const discountHTML = `
                        <div class="card-msg-container">
                            <div class="discount-container">
                                <h3 style="color:#0F2546; margin-bottom:5px;">Desconto Liberado</h3>
                                <div class="discount-box">
                                    <span class="discount-val">- R$ ${selected.desconto},00</span>
                                    <small style="color:#d32f2f; font-weight:bold">V√°lido 30 dias</small>
                                </div>
                                <button class="cta-btn" onclick="openWa('${selected.nome}', ${selected.desconto})">
                                    GARANTIR DESCONTO AGORA <i class="fa-solid fa-check-circle"></i>
                                </button>
                                <p style="font-size:10px; color:#999; margin-top:5px">Sem compromisso.</p>
                            </div>
                        </div>
                    `;
                    await addMessage(discountHTML, 'bot');
                    await addMessage("Clique acima para garantir. üëÜ", 'bot', 800);
                    
                    const textSave = encodeURIComponent("Estou salvando seu contato");
                    await addMessage(`N√£o esque√ßa de salvar nosso contato: <a href="https://wa.me/${CONFIG.whatsAppSaveNumber}?text=${textSave}" target="_blank" class="text-link">65 99815-0965</a>`, 'bot', 1000);
                    break;
            }
        }

        const getGreeting = () => {
            const h = new Date().getHours();
            return h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";
        };

        window.openWa = function(cesta, desconto) {
            const msg = `Ol√°! Sou ${state.userName}. Tenho interesse na *${cesta}* e quero garantir meu desconto de *R$ ${desconto},00*.`;
            window.open(`https://wa.me/${CONFIG.whatsAppNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            trackEvent('Lead');
            
            setTimeout(() => {
                const socialHTML = `
                    <div class="social-container">
                        <a href="${CONFIG.instagramLink}" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i> Seguir Instagram</a>
                        <a href="${CONFIG.whatsAppGroupLink}" target="_blank" class="group-btn"><i class="fa-solid fa-star"></i> Entrar Grupo VIP</a>
                    </div>
                `;
                addMessage(socialHTML, 'bot', 1000);
            }, 1000);
        }

        sendBtn.onclick = handleInput;
        userInput.onkeypress = (e) => { if(e.key === 'Enter') handleInput(); }

    </script>
</body>
</html>
